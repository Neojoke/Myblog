---
title: iOS10é‡Œçš„é€šçŸ¥ä¸æ¨é€
date:  2016-12-10 18:26:00
categories:
- æœ¯-æŠ€æœ¯ç»¼åˆå®è·µ
tags:
- iOS
---

æœ¬æ–‡ç¯‡å¹…è¾ƒé•¿ï¼Œå…ƒæ—¦åå°†é‡æ–°æ’ç‰ˆæ¢³ç†è¡Œæ–‡ï¼Œäº¤æµæ˜¯ä¸€ä»¶éå¸¸æœ‰ä»·å€¼çš„äº‹æƒ…~

# iOS é‡Œçš„é€šçŸ¥ä¸æ¨é€

#æŠ€æœ¯æ–‡ç«  #å¾…å®Œå–„
â€œæ¨é€æœ‰ä»€ä¹ˆå¥½è®²çš„ï¼ŸğŸ¤”ğŸ¤”ğŸ¤”â€
---æ•²é»‘æ¿

é€šçŸ¥å’Œæ¨é€æ˜¯ä¸€ç§ä¸œè¥¿ä¹ˆï¼Ÿ
![iOS10é€šçŸ¥](http://upload-images.jianshu.io/upload_images/24274-69890ea38bc6d6cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![æ¨é€](http://upload-images.jianshu.io/upload_images/24274-9289a616fb9f7ef2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
å›¾ 1 ä¸ºé€šçŸ¥ï¼Œå›¾ 2 ä¸ºæ¨é€
ä¹Ÿè®¸æœ‰äº›åŒå­¦ç°åœ¨æ‰æç„¶å¤§æ‚Ÿï¼Œä»Šå¤©æˆ‘ä»¬å°±èŠèŠè¿™ä¸ªé€šçŸ¥å’Œæ¨é€å§ã€‚

### ä»€ä¹ˆå«é€šçŸ¥ï¼Œä»€ä¹ˆå«æ¨é€ï¼Ÿ

é€šçŸ¥æ˜¯ iOS æ“ä½œç³»ç»Ÿå±‚é¢ä¸Šçš„åŠŸèƒ½ï¼Œè¯´ç™½äº†å°±æ˜¯ iPhone ä¸Šçš„é€šçŸ¥æ¡ï¼Œé€šçŸ¥ä¸­å¿ƒç­‰ï¼ŒApp æ¥äº†ä¸€æ¡é€šçŸ¥ï¼Œç³»ç»Ÿæ¥äº†å‡çº§é€šçŸ¥ï¼Œå¾…åŠäº‹é¡¹æ¥äº†ä¸€æ¡é€šçŸ¥ï¼Œè¿™é‡Œçš„é€šçŸ¥æŒ‡çš„æ˜¯ iOS æ“ä½œç³»ç»Ÿå†…çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œæ›´å¤šä½“ç°åœ¨ UIã€äº¤äº’ã€è§¦å‘é€»è¾‘ã€é€šçŸ¥æ–¹å¼ä¸Šã€‚
æ¨é€æŒ‡çš„æ˜¯ç”± APNs æœåŠ¡å™¨ã€ProviderServiceã€iOS ç³»ç»Ÿã€App æ„æˆçš„é€šè®¯ç³»ç»Ÿï¼Œæ˜¯ç§»åŠ¨äº’è”ç½‘ä¸ä¼ ç»Ÿçš„ Web æœ€æ˜æ˜¾çš„åŒºåˆ«çš„åœ°æ–¹ã€‚æ­£å› ä¸ºæœ‰äº†æ¨é€ï¼Œå®ç°äº†æœåŠ¡ç«¯èƒ½å¤Ÿåå‘ä¸ç”¨æˆ·å»ºç«‹è”ç³»ï¼Œè€Œä¸æ˜¯ç­‰å¾…ç”¨æˆ·è®¿é—® Web æœåŠ¡å™¨ã€‚è¿™é‡Œæˆ‘ä»¬ç€é‡è®²ä¸€ä¸‹ APNs ä¸ ProviderServiceã€‚

#### APNs(Apple Push Notification service-è‹¹æœæ¨é€é€šçŸ¥æœåŠ¡)

[APNs å®˜æ–¹æ–‡æ¡£](https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html#//apple_ref/doc/uid/TP40008194-CH8-SW1)
APNs æ˜¯æ¨é€çš„æ ¸å¿ƒã€‚è¯¥æœåŠ¡ä¸ iOS è®¾å¤‡å»ºç«‹èµ·å¼ºå¤§çš„æŒä¹…è¿æ¥é€šè®¯ï¼ˆå’Œé—´æ¥ WatchOSï¼ŒTVOSï¼Œå’Œ MacOS è®¾å¤‡ï¼‰ã€‚åœ¨æ—©æœŸçš„æ—¶å€™ï¼ŒiOS é€šè¿‡ç®¡ç† AppSSL è®¤è¯çš„æ¨é€è¯ä¹¦ä¸ APNs å»ºç«‹èµ·é•¿è¿æ¥é€šè®¯ï¼Œä½†ä¸æ˜¯å¯é çš„é€šè®¯ã€‚éšåï¼ŒAPNs ä½¿ç”¨æŒä¹…è¿æ¥è¿›è¡ŒæœåŠ¡ç«¯æ¨é€ã€‚åœ¨é•¿æœŸçš„æ¼”è¿›è¿‡ç¨‹ä¸­ï¼Œç°åœ¨ iOS10 æä¾›çš„ APNs æœåŠ¡æ˜¯åŸºäº HTTP/2 åè®®æ ˆåŒæ—¶ä½¿ç”¨[Json Web Tokenï¼ˆjson ä»¤ç‰Œï¼‰](https://jwt.io/)ä¿è¯é€šè®¯å®‰å…¨ã€‚æœ‰å¦‚ä¸‹å‡ é¡¹æ”¹è¿›:

1.  iOS8 ä»¥åï¼ŒAPNs æ¨é€çš„å­—èŠ‚æ˜¯ 2kï¼ŒiOS8 ä»¥å‰æ˜¯ 256 å­—èŠ‚ï¼ŒiOS10 ç°åœ¨æ˜¯ 4k
2.  iOS9 ä»¥å APNs æ”¯æŒ HTTP/2 åè®®æ ˆï¼Œä¼˜åŒ–é•¿è¿æ¥ï¼Œå…·æœ‰æ ‡å‡†çš„ HTTP è¿”å›å’Œç®¡é“å¤ç”¨æŠ€æœ¯
3.  iOS10 ä»¥åï¼ŒAPNs å¯æ ¹æ®æ¨é€æ¶ˆæ¯çš„å”¯ä¸€æ ‡ç¤ºç¬¦æŸ¥è¯¢æŸæ¡æ¶ˆæ¯æ˜¯å¦è¢«ç”¨æˆ·é˜…è¯»ï¼Œå¯æ›´æ–°æŸä¸€æ¨é€æ¶ˆæ¯ï¼Œè€Œä¸ç”¨å‘é‡è¯»çš„å¤šæ¡æ¶ˆæ¯

æ›´å¤šçš„è¯¦ç»†è§£é‡Šæœ‰ä¸€ç¯‡æ–‡ç« å«åš [ã€Šå›½å†… 90%ä»¥ä¸Šçš„ iOS å¼€å‘è€…ï¼Œå¯¹ APNs çš„è®¤è¯†éƒ½æ˜¯é”™çš„ã€‹](http://www.jianshu.com/p/ace1b422bad4)ï¼Œå¤§å®¶å¯ä»¥æ·±å…¥äº†è§£ã€‚

#### é€šçŸ¥

iOS æ“ä½œç³»ç»Ÿçš„é€šçŸ¥åŒ…æ‹¬äº† App çš„é€šçŸ¥ã€ç³»ç»Ÿçš„é€šçŸ¥å’Œå®˜æ–¹åº”ç”¨çš„é€šçŸ¥ï¼Œå®è´¨ä¸Šå°±æ˜¯æ¨é€çš„æ•°æ®åœ¨ iOS æ“ä½œç³»ç»Ÿä¸Šçš„è¡¨ç°å’Œæœ¬åœ°é€šçŸ¥åœ¨ iOS æ“ä½œç³»ç»Ÿçš„è¡¨ç°ï¼Œåœ¨äº¤äº’ä¸Š iOS10 çš„é€šçŸ¥å¤§å¤§å¢å¼ºï¼Œå¯å®šåˆ¶åŒ– UIï¼Œå¢åŠ äº†æ›´åŠ ç»†åˆ†çš„é€šçŸ¥æƒé™ç®¡ç†å’Œæ›´å¤šçš„é€šçŸ¥è®¾å®šï¼Œä¾‹å¦‚è¿œç¨‹é€šçŸ¥ã€æ—¶é—´é€šçŸ¥ã€åœ°ç†ä½ç½®é€šçŸ¥å’Œæ—¥å†é€šçŸ¥ã€‚
å¾ˆå¤šå¼€å‘è€…éƒ½çŸ¥é“ iOS10 ä¸­è‹¹æœå‡çº§æ¨å‡ºäº† [User Notifications Framework](https://developer.apple.com/reference/usernotifications)ä¸ [User Notifications UI Framework](https://developer.apple.com/reference/usernotificationsui)ä¸¤ä¸ªæ¡†æ¶ï¼Œä½†æ˜¯åƒä¸‡ä¸è¦è·Ÿæ¨é€æ··ä¸ºä¸€è°ˆï¼Œè¿™ä¸¤ä¸ªæ¡†æ¶å‡çº§å’Œæ‰“åŒ…çš„æ˜¯é€šçŸ¥çš„åŠŸèƒ½å¢åŠ å’Œé€šçŸ¥äº¤äº’å±‚é¢ä¸Šçš„æ”¹è¿›ã€‚

> ** æ¨é€ Push åªä¸è¿‡æ˜¯ iOS10 é€šçŸ¥çš„ä¸€ç§è§¦å‘å™¨ã€‚**

#### é…åˆæœ€æ–°çš„æ¨é€æœåŠ¡ä½¿ç”¨å¼ºå¤§çš„ iOS10 é€šçŸ¥åŠŸèƒ½

é‡ç‚¹ä»‹ç»ä¸€ä¸‹ iOS10 çš„é€šçŸ¥æ–°åŠŸèƒ½ï¼Œç”¨æˆ·ä½“éªŒçš„æå‡å’Œå¼€å‘è€…èƒ½å¤Ÿå‘æŒ¥çš„åœ°æ–¹éå¸¸å¤šï¼Œä½¿å¾— iOS æ›´å…·æœ‰ç«äº‰åŠ›ã€‚

1.  iOS10 é€šçŸ¥ç³»ç»Ÿæ”¯æŒ Images, GIFs, Audio and Video ç±»å‹
2.  iOS10 æ¨å‡º Notification Service Extension ä¸ Notification Content Extensionï¼Œå¯ä»¥å®ç°æ¨é€æ•°æ®åœ¨å±•ç¤ºå‰è¿›è¡Œä¸‹è½½æ›´æ–°ã€å®šåˆ¶é€šçŸ¥ UI
3.  iOS10 ç»Ÿä¸€äº†é€šçŸ¥ç±»å‹ï¼Œå…·æœ‰æ—¶é—´é—´éš”é€šçŸ¥ã€åœ°ç†ä½ç½®é€šçŸ¥å’Œæ—¥å†é€šçŸ¥
    ![iOSé‡Œçš„é€šçŸ¥æ‰©å±•](http://upload-images.jianshu.io/upload_images/24274-f657bc8d508a3156.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#### User Notifications Framework ä»‹ç»ï¼š

å…³ç³»å›¾ï¼š
![User Notifications Frameworkç±»å…³ç³»å›¾](http://upload-images.jianshu.io/upload_images/24274-37256961624d3d1a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
é‡ç‚¹ä»‹ç»ï¼š

1.  UNUserNotificationCenter é€šçŸ¥ä¸­å¿ƒï¼Œç”¨ä»¥ç®¡ç†é€šçŸ¥çš„æ³¨å†Œã€æƒé™è·å–å’Œç®¡ç†ã€é€šçŸ¥çš„åˆ é™¤ä¸æ›´æ–°ï¼Œé€šè¿‡ä»£ç†åˆ†å‘äº‹ä»¶ç­‰ã€‚
2.  UNNotification é€šçŸ¥å®ä½“ï¼Œåœ¨ UNUserNotificationCenter çš„ä»£ç†å›è°ƒäº‹ä»¶ä¸­ï¼Œå‘ŠçŸ¥ App æ¥æ”¶åˆ°ä¸€æ¡é€šçŸ¥ï¼ŒåŒ…å«ä¸€ä¸ªå‘èµ·é€šçŸ¥çš„è¯·æ±‚ UNNotificationRequest
3.  UNNotificationRequest åŒ…å«é€šçŸ¥å†…å®¹ UNNotificationContent å’Œè§¦å‘å™¨ UNNotificationTrigger
4.  UNNotificationContent é€šçŸ¥å†…å®¹ï¼Œé€šçŸ¥çš„ titleï¼Œsoundï¼Œbadge ä»¥åŠç›¸å…³çš„å›¾åƒã€å£°éŸ³ã€è§†é¢‘é™„ä»¶ UNNotificationAttachmentï¼Œè§¦å‘æ‰“å¼€ App æ—¶å€™æŒ‡å®šçš„ LacnchImage ç­‰
5.  UNNotificationResponseï¼Œç”¨æˆ·åœ¨è§¦å‘äº†æŒ‰é’®æˆ–è€…æ–‡æœ¬æäº¤çš„ UNNotificationAction çš„æ—¶å€™ï¼Œä¼šå½¢æˆä¸€ä¸ª responseï¼Œé€šè¿‡é€šçŸ¥ä¸­å¿ƒçš„ä»£ç†æ–¹æ³•å›è°ƒç»™ App è¿›è¡Œå¤„ç†æˆ–è€…æ˜¯äº¤ç»™æ‰©å±•å¤„ç†ã€‚
6.  UNNotificationServiceExtensionï¼Œæ˜¯ä¸€ä¸ªåœ¨æ¥æ”¶åˆ° APNs æœåŠ¡å™¨æ¨é€è¿‡æ¥çš„æ•°æ®è¿›è¡Œå¤„ç†çš„æœåŠ¡æ‰©å±•ï¼Œå¦‚æœ App æä¾›äº†æœåŠ¡æ‰©å±•ï¼Œé‚£ä¹ˆ APNs ä¸‹å‘æ¨é€ååœ¨é€šçŸ¥æ˜¾ç¤ºè§¦å‘ä¹‹å‰ï¼Œä¼šåœ¨ UNNotificationServiceExtension å†…æ¥æ”¶åˆ°ï¼Œæ­¤å¤„æœ‰å¤§çº¦ 30 ç§’çš„å¤„ç†æ—¶é—´ï¼Œå¼€å‘è€…å¯ä»¥è¿›è¡Œä¸€äº›æ•°æ®ä¸‹è½½ã€æ•°æ®è§£å¯†ã€æ›´æ–°ç­‰æ“ä½œï¼Œç„¶åäº¤ç”±è€Œåçš„å†…å®¹æ‰©å±•(UNNotificationContentExtension)æˆ–è€…æ˜¯ App è¿›è¡Œè§¦å‘æ˜¾ç¤º
7.  UNNotificationCategory,ç”¨ä»¥å®šä¹‰ä¸€ç»„æ ·å¼ç±»å‹ï¼Œè¯¥åˆ†ç±»åŒ…å«äº†æŸä¸€ä¸ªé€šçŸ¥åŒ…å«çš„äº¤äº’åŠ¨ä½œçš„ç»„åˆï¼Œæ¯”å¦‚è¯´ UNNotificationRequest å†…åŒ…å«äº†ä¸€ä¸ª Category æ ‡ç¤ºï¼Œé‚£è¯¥é€šçŸ¥å°±ä¼šä»¥é¢„å®šä¹‰å¥½çš„äº¤äº’æŒ‰é’®æˆ–è€…æ–‡æœ¬æ¡†æ·»åŠ åˆ°é€šçŸ¥å®ä½“ä¸Šã€‚
8.  UNNotificationAttachmentï¼Œé€šçŸ¥å†…å®¹ UNNotificationContent åŒ…å«çš„é™„ä»¶ï¼Œä¸€èˆ¬ä¸ºå›¾ç‰‡ã€è§†é¢‘å’ŒéŸ³é¢‘ï¼Œè™½ç„¶ iOS10 çš„é€šçŸ¥æ•°æ®å®¹é‡ä¸º 4kï¼Œä½†ä¾æ—§å¾ˆå°‘ï¼Œåœ¨æ·»åŠ äº† UNNotificationServiceExtension æ‰©å±•çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨æœåŠ¡é‡Œä¸‹è½½å›¾ç‰‡ï¼Œç”Ÿæˆå›¾ç‰‡ã€è§†é¢‘ç­‰çš„æœ¬åœ°ç¼“å­˜ï¼ŒUNNotificationAttachment æ ¹æ®ç¼“å­˜æ•°æ®ç”Ÿæˆå¹¶æ·»åŠ åˆ° UNNotificationContent ä¸­ï¼Œäº¤ç”± UI æ˜¾ç¤º
9.  UNNotificationActionï¼Œæ˜¯é€šçŸ¥ä¸­æ·»åŠ çš„ actionï¼Œå±•ç¤ºåœ¨é€šçŸ¥æ çš„ä¸‹æ–¹ã€‚é»˜è®¤ä»¥çš„ button æ ·å¼å±•ç¤ºã€‚æœ‰ä¸€ä¸ªæ–‡æœ¬è¾“å…¥çš„å­ç±» UNTextInputNotificationActionã€‚å¯ä»¥åœ¨ç‚¹å‡» button ä¹‹åå¼¹å‡ºä¸€ä¸ªé”®ç›˜ï¼Œè¾“å…¥ä¿¡æ¯ã€‚ç”¨æˆ·ç‚¹å‡»ä¿¡æ¯å’Œè¾“å…¥çš„ä¿¡æ¯å¯ä»¥åœ¨ UNNotificationResponse ä¸­è·å–

#### User Notifications UI Framework ä»‹ç»ï¼š

å…³ç³»å›¾ï¼š
![User Notifications UI Frameworkç±»å…³ç³»å›¾](http://upload-images.jianshu.io/upload_images/24274-5abb3af200cb96e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

1.  ï¿¼UNNotificationContentExtension<åè®®>ï¼ŒNotificationViewController å®ç°è¯¥åè®®ï¼Œå¯ä»¥è·å¾— iOS å±•ç¤ºè‡ªå®šä¹‰ UI æ—¶å€™åˆ†å‘çš„ UNNotification å¯¹è±¡å’Œç”¨æˆ·äº¤äº’çš„ Response
2.  NotificationViewControllerï¼ŒApp æ·»åŠ  Notification Content Extension æ‰©å±•çš„æ—¶å€™ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„ Controllerï¼Œå¯ä»¥å®šä¹‰é€šçŸ¥ UI çš„ä¸»é¢˜éƒ¨åˆ†ï¼Œç”± StoryBoard æŒ‡å®šè®¾è®¡

#### iOS10 æ³¨å†Œé€šçŸ¥ã€å›è°ƒå¤„ç†

åªç®€å•ä»‹ç»ä¸€ä¸‹ iOS10 çš„é€šçŸ¥æ³¨å†Œ

```
UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];
    // å¿…é¡»å†™ä»£ç†ï¼Œä¸ç„¶æ— æ³•ç›‘å¬é€šçŸ¥çš„æ¥æ”¶ä¸ç‚¹å‡»
    center.delegate = self;
//è®¾ç½®é¢„è®¾å¥½çš„äº¤äº’ç±»å‹ï¼ŒNSSeté‡Œé¢æ˜¯è®¾ç½®å¥½çš„UNNotificationCategory
    [center setNotificationCategories:[self createNotificationCategoryActions]];
    [center getNotificationSettingsWithCompletionHandler:^(UNNotificationSettings * _Nonnull settings) {
        if (settings.authorizationStatus==UNAuthorizationStatusNotDetermined) {
            [center requestAuthorizationWithOptions:(UNAuthorizationOptionAlert | UNAuthorizationOptionBadge | UNAuthorizationOptionSound) completionHandler:^(BOOL granted, NSError * _Nullable error) {
                if (granted) {

                } else {

                }
            }];
        }
        else{
            //do other things
        }
    }];


 - (void)application:(UIApplication *)application
didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken {
    //ä¸Šä¼ token
}
- (void)application:(UIApplication *)application
didFailToRegisterForRemoteNotificationsWithError:(NSError *)error {
    //è·å–tokenå¤±è´¥ï¼Œå¼€å‘è°ƒè¯•çš„æ—¶å€™éœ€è¦å…³æ³¨ï¼Œå¿…è¦çš„æƒ…å†µä¸‹å°†å…¶ä¸Šä¼ åˆ°å¼‚å¸¸ç»Ÿè®¡
}
//ä»£ç†å›è°ƒæ–¹æ³•ï¼Œé€šçŸ¥å³å°†å±•ç¤ºçš„æ—¶å€™
- (void)userNotificationCenter:(UNUserNotificationCenter *)center willPresentNotification:(UNNotification *)notification withCompletionHandler:(void (^)(UNNotificationPresentationOptions options))completionHandler{

    UNNotificationRequest *request = notification.request; // åŸå§‹è¯·æ±‚
NSDictionary * userInfo = notification.request.content.userInfo;//userInfoæ•°æ®
    UNNotificationContent *content = request.content; // åŸå§‹å†…å®¹
    NSString *title = content.title;  // æ ‡é¢˜
    NSString *subtitle = content.subtitle;  // å‰¯æ ‡é¢˜
    NSNumber *badge = content.badge;  // è§’æ ‡
    NSString *body = content.body;    // æ¨é€æ¶ˆæ¯ä½“
    UNNotificationSound *sound = content.sound;  // æŒ‡å®šçš„å£°éŸ³
//å»ºè®®å°†æ ¹æ®Notificationè¿›è¡Œå¤„ç†çš„é€»è¾‘ç»Ÿä¸€å°è£…ï¼ŒåæœŸå¯åœ¨Extensionä¸­å¤ç”¨~
    completionHandler(UNNotificationPresentationOptionBadge|UNNotificationPresentationOptionSound|UNNotificationPresentationOptionAlert); // å›è°ƒblockï¼Œå°†è®¾ç½®ä¼ å…¥
}

//ç”¨æˆ·ä¸é€šçŸ¥è¿›è¡Œäº¤äº’åçš„responseï¼Œæ¯”å¦‚è¯´ç”¨æˆ·ç›´æ¥ç‚¹å¼€é€šçŸ¥æ‰“å¼€Appã€ç”¨æˆ·ç‚¹å‡»é€šçŸ¥çš„æŒ‰é’®æˆ–è€…è¿›è¡Œè¾“å…¥æ–‡æœ¬æ¡†çš„æ–‡æœ¬
- (void)userNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(void(^)())completionHandler{

    UNNotificationRequest *request = response.notification.request; // åŸå§‹è¯·æ±‚
NSDictionary * userInfo = notification.request.content.userInfo;//userInfoæ•°æ®
    UNNotificationContent *content = request.content; // åŸå§‹å†…å®¹
    NSString *title = content.title;  // æ ‡é¢˜
    NSString *subtitle = content.subtitle;  // å‰¯æ ‡é¢˜
    NSNumber *badge = content.badge;  // è§’æ ‡
    NSString *body = content.body;    // æ¨é€æ¶ˆæ¯ä½“
    UNNotificationSound *sound = content.sound;
//åœ¨æ­¤ï¼Œå¯åˆ¤æ–­responseçš„ç§ç±»å’Œrequestçš„è§¦å‘å™¨æ˜¯ä»€ä¹ˆï¼Œå¯æ ¹æ®è¿œç¨‹é€šçŸ¥å’Œæœ¬åœ°é€šçŸ¥åˆ†åˆ«å¤„ç†ï¼Œå†æ ¹æ®actionè¿›è¡Œåç»­å›è°ƒ

}
```

ä»¥ä¸Šå°±æ˜¯ iOS10 çš„é€šçŸ¥ä¸­å¿ƒæ³¨å†Œå’Œè®¾ç½®ç®¡ç†çš„è¿‡ç¨‹ï¼Œä¸€ä¸‹è¿˜æœ‰ä¸€äº›æ¯”è¾ƒæœ‰ç”¨ APIï¼š

```
//è·å–åœ¨PendingçŠ¶æ€ä¸‹å¾…è§¦å‘çš„é€šçŸ¥
- (void)getPendingNotificationRequestsWithCompletionHandler:(void(^)(NSArray<UNNotificationRequest *> *requests))completionHandler;
//ç§»é™¤æœªè§¦å‘çš„é€šçŸ¥
- (void)removePendingNotificationRequestsWithIdentifiers:(NSArray<NSString *> *)identifiers;
- (void)removeAllPendingNotificationRequests;

// é€šçŸ¥å·²ç»è§¦å‘ï¼Œä½†æ˜¯è¿˜åœ¨æ“ä½œç³»ç»Ÿçš„é€šçŸ¥ä¸­å¿ƒä¸Šï¼Œå¯ä»¥è¿›è¡ŒæŸ¥è¯¢å’Œåˆ é™¤
- (void)getDeliveredNotificationsWithCompletionHandler:(void(^)(NSArray<UNNotification *> *notifications))completionHandler __TVOS_PROHIBITED;
- (void)removeDeliveredNotificationsWithIdentifiers:(NSArray<NSString *> *)identifiers __TVOS_PROHIBITED;
- (void)removeAllDeliveredNotifications __TVOS_PROHIBITED;
```

#### iOS10 æœ¬åœ°é€šçŸ¥

```
UNMutableNotificationContent *content = [[UNMutableNotificationContent alloc] init];
    content.title = @"\"Fly to the moon\"";
    content.subtitle = @"by Neo";
    content.body = @"the wonderful song with you~";
    content.badge = @0;
    NSString *path = [[NSBundle mainBundle] pathForResource:@"image1" ofType:@"png"];
    NSError *error = nil;
//å°†æœ¬åœ°å›¾ç‰‡çš„è·¯å¾„å½¢æˆä¸€ä¸ªå›¾ç‰‡é™„ä»¶ï¼ŒåŠ å…¥åˆ°contentä¸­
    UNNotificationAttachment *img_attachment = [UNNotificationAttachment attachmentWithIdentifier:@"att1" URL:[NSURL fileURLWithPath:path] options:nil error:&error];
    if (error) {
        NSLog(@"%@", error);
    }
    content.attachments = @[img_attachment];
    //è®¾ç½®ä¸º@""ä»¥åï¼Œè¿›å…¥appå°†æ²¡æœ‰å¯åŠ¨é¡µ
    content.launchImageName = @"";
    UNNotificationSound *sound = [UNNotificationSound defaultSound];
    content.sound = sound;
    //è®¾ç½®æ—¶é—´é—´éš”çš„è§¦å‘å™¨
    UNTimeIntervalNotificationTrigger *time_trigger = [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:10 repeats:NO];
    NSString *requestIdentifer = @"time interval request";
    content.categoryIdentifier = @"";
    UNNotificationRequest *request = [UNNotificationRequest requestWithIdentifier:requestIdentifer content:content trigger:time_trigger];
    [[UNUserNotificationCenter currentNotificationCenter] addNotificationRequest:request withCompletionHandler:^(NSError * _Nullable error) {
        NSLog(@"%@",error);
    }];
```

è¿™é‡Œé¢çš„å›¾ç‰‡é™„ä»¶åé¢å†è¿°ï¼Œè¿‡ç¨‹ä¸Šèƒ½æ„Ÿå—åˆ°ï¼Œé€šçŸ¥æ•°æ®éƒ¨åˆ†åœ¨ UNMutableNotificationContent ä¸­è®¾ç½®ï¼Œé™„ä»¶ UNNotificationAttachment ä¹Ÿæ˜¯åœ¨å…¶ä¸­åŒ…å«ï¼ŒcategoryIdentifier ä¸ºæŒ‡å®šè¯¥é€šçŸ¥å¯¹åº”çš„äº¤äº’æ ·å¼ï¼Œä¹Ÿå°±æ˜¯å‰é¢è®¾ç½®çš„ UNNotificationCategory çš„å¯¹è±¡ï¼Œåé¢å†è¿°ã€‚ç„¶ååˆ›å»ºè§¦å‘å™¨ï¼ŒUNTimeIntervalNotificationTriggerï¼Œè§¦å‘å™¨æœ‰å¾ˆå¤šç§ï¼ŒUNNotificationTrigger æœ‰å››ä¸ªå­ç±»ï¼š

1.  UNPushNotificationTriggerï¼Œè¿œç¨‹æ¨é€è§¦å‘å™¨ï¼Œä¸€èˆ¬æ˜¯è¿œç¨‹æ¨é€æ¨è¿‡æ¥çš„é€šçŸ¥å¸¦æœ‰è¿™ç±»è§¦å‘å™¨
2.  UNTimeIntervalNotificationTriggerï¼Œæ—¶é—´é—´éš”è§¦å‘å™¨ï¼Œå®šæ—¶æˆ–è€…æ˜¯é‡å¤ï¼Œåœ¨æœ¬åœ°æ¨é€è®¾ç½®ä¸­æœ‰ç”¨
3.  UNCalendarNotificationTriggerï¼Œæ—¥å†è§¦å‘å™¨ï¼ŒæŒ‡å®šæ—¥æœŸè¿›è¡Œé€šçŸ¥
4.  UNLocationNotificationTriggerï¼Œåœ°ç†ä½ç½®è§¦å‘å™¨ï¼ŒæŒ‡å®šè§¦å‘é€šçŸ¥çš„æ¡ä»¶æ˜¯åœ°ç†ä½ç½® CLRegion è¿™ä¸ªç±»å‹ã€‚
    è§¦å‘å™¨å’Œå†…å®¹æœ€åå½¢æˆ UNNotificationRequestï¼Œä¸€ä¸ªé€šçŸ¥è¯·æ±‚ï¼Œæœ¬åœ°é€šçŸ¥çš„è¯·æ±‚ï¼Œç›´æ¥äº¤ç»™é€šçŸ¥ä¸­å¿ƒè¿›è¡Œå‘é€ï¼Œå‘é€æˆåŠŸåï¼Œè¯¥é€šçŸ¥ä¼šæŒ‰ç…§è§¦å‘å™¨çš„è§¦å‘æ¡ä»¶è¿›è¡Œè§¦å‘ï¼Œå¹¶ä¸”ä¼šæ˜¾ç¤ºåˆ°é€šçŸ¥ä¸­å¿ƒä¸Šï¼Œç”¨æˆ·å¯ä¸æŒ‡å®šçš„ category äº¤äº’æ–¹å¼ä¸é€šçŸ¥è¿›è¡Œäº¤äº’
    å¦‚ä¸‹å›¾ï¼š
    ![localTimeNotification.gif](http://upload-images.jianshu.io/upload_images/24274-bfc31161505a9517.gif?imageMogr2/auto-orient/strip)

#### iOS10 è¿œç¨‹é€šçŸ¥

è¿œç¨‹é€šçŸ¥ä¸æœ¬åœ°é€šçŸ¥çš„æµç¨‹ä¸€æ ·ï¼Œåªä¸è¿‡è§¦å‘å™¨æ˜¯ UNPushNotificationTriggerï¼Œå¹¶ä¸”ä¸éœ€è¦å½¢æˆ requestï¼Œåˆ Provider Service å‘é€ç»™ APNs åˆ° iOS ä»¥åç”Ÿæˆï¼Œåœ¨ä»£ç†å›è°ƒçš„å‡½æ•°ä¸­è·å– request

#### é€šçŸ¥çš„ä»£ç†å›è°ƒ

ä¸Šé¢ä»£ç æœ‰äº›ä»£ç†å›è°ƒå‡½æ•°ï¼Œå¯ä»¥åœ¨è¿™ä¸¤ä¸ªä»£ç†å›è°ƒå‡½æ•°é‡Œåšä¸€äº›äº‹æƒ…

```
- (void)userNotificationCenter:(UNUserNotificationCenter *)center willPresentNotification:(UNNotification *)notification withCompletionHandler:(void (^)(UNNotificationPresentationOptions options))completionHandler{
		//è¯¥å›è°ƒå‡½æ•°æ˜¯åœ¨é€šçŸ¥æ¡å³å°†æ˜¾ç¤ºä¹‹å‰è°ƒç”¨çš„
	if ([request.trigger isKindOfClass:[UNPushNotificationTrigger class]]) {
        //è¿œç¨‹é€šçŸ¥å¤„ç†
    }
    if ([request.trigger isKindOfClass:[UNTimeIntervalNotificationTrigger class]]) {
        //æ—¶é—´é—´éš”é€šçŸ¥å¤„ç†
    }
    if () {
        //åŠ è§£å¯†ï¼Œæ•°æ®ä¸‹è½½,å®Œæˆåè°ƒç”¨completionHandler
    }
    else{
        completionHandler(UNNotificationPresentationOptionBadge|UNNotificationPresentationOptionSound|UNNotificationPresentationOptionAlert);
    }
}
```

å¦‚æœä½ çš„ App åœ¨å‰å°ï¼Œä¸€èˆ¬åœ¨è¿™ä¸ªå›è°ƒå‡½æ•°é‡Œåšä¸€äº›æ•°æ®åŠ è§£å¯†ã€æ•°æ®ä¸‹è½½ï¼Œç„¶åå°†ä¸‹è½½çš„æ•°æ®ç»„è£…æˆ UNNotificationAttachment æˆ–è€…æ˜¯æ ¹æ®é€šçŸ¥é‡Œé¢çš„ content é‡Œé¢çš„ userinfo é‡Œä¸åç«¯æœåŠ¡çº¦å®šå¥½çš„ä¿®æ”¹é€šçŸ¥å¯¹åº”çš„ categoryIdï¼Œè°ƒç”¨ç›¸åº”çš„äº¤äº’ç»„ä»¶åˆ°é€šçŸ¥ä¸Šï¼ŒcompletionHandler åœ¨ä½ æƒ³è¦åšçš„é€»è¾‘å®Œæˆä»¥åè°ƒç”¨ã€‚
**å¦‚æœ App åœ¨å‰å°ï¼Œä½ æ¥æ”¶åˆ°é€šçŸ¥ï¼Œä¸æƒ³æ˜¾ç¤ºç³»ç»Ÿæç¤ºæ¡†ï¼Œæƒ³ä½¿ç”¨ App è‡ªå®šä¹‰çš„é€šçŸ¥æ¶ˆæ¯å¼¹çª—ï¼Œå¯ä»¥åœ¨ completionHandler å›è°ƒçš„æ—¶å€™ä¼ å…¥çš„ opinion ä¸è¦å¸¦ä¸Š UNAuthorizationOptionAlertï¼Œç„¶åç›´æ¥å¼¹è‡ªå®šä¹‰çš„å¼¹çª—å°± Okã€‚**

> æ³¨æ„ï¼šæ”¹å›è°ƒå‡½æ•°ä»…ä»…ç”¨æ¥å¤„ç†æ•°æ®å’Œé‡æ–°é€‰æ‹©äº¤äº’æ–¹å¼ï¼Œå…¶ä»–è¿œç¨‹æ¨é€åˆ°è¾¾è®¾å¤‡è¦åšçš„ä¸šåŠ¡é€»è¾‘ï¼Œæœ€å¥½ä¸è¦åœ¨æ­¤å›è°ƒå‡½æ•°è§¦å‘ï¼Œä¿æŒèŒè´£å•ä¸€

```
//ç”¨æˆ·ä¸é€šçŸ¥è¿›è¡Œäº¤äº’åçš„responseï¼Œæ¯”å¦‚è¯´ç”¨æˆ·ç›´æ¥ç‚¹å¼€é€šçŸ¥æ‰“å¼€Appã€ç”¨æˆ·ç‚¹å‡»é€šçŸ¥çš„æŒ‰é’®æˆ–è€…è¿›è¡Œè¾“å…¥æ–‡æœ¬æ¡†çš„æ–‡æœ¬
- (void)userNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(void(^)())completionHandler{
    //åœ¨æ­¤ï¼Œå¯åˆ¤æ–­responseçš„ç§ç±»å’Œrequestçš„è§¦å‘å™¨æ˜¯ä»€ä¹ˆï¼Œå¯æ ¹æ®è¿œç¨‹é€šçŸ¥å’Œæœ¬åœ°é€šçŸ¥åˆ†åˆ«å¤„ç†ï¼Œå†æ ¹æ®actionè¿›è¡Œåç»­å›è°ƒ
    if ([response.actionIdentifier isEqualToString:@""]) {

    }
    //ä¹Ÿå¯æ ¹æ®response åˆ¤æ–­æ˜¯å¦æ˜¯textæ–‡æœ¬è¾“å…¥
    if ([response isKindOfClass:[UNTextInputNotificationResponse class]]) {
        //è¯¥å‡½æ•°æ˜¯åœ¨ç”¨æˆ·ç‚¹å‡»é€šçŸ¥æˆ–è€…æ˜¯ä¸é€šçŸ¥ä¸Šé¢æŒ‡å®šå¥½çš„actionè¿›è¡Œäº†äº¤äº’å›è°ƒçš„å‡½æ•°ï¼Œç”¨æˆ·è§¦å‘é€šçŸ¥çš„ä¸šåŠ¡é€»è¾‘æœ€å¥½æ”¾åœ¨æ­¤å¤„
    }
}
```

#### iOS10 é€šçŸ¥äº¤äº’ï¼ŒUNNotificationAction ä¸ UNNotificationCategory

![ç»„åˆæŒ‰é’®](http://upload-images.jianshu.io/upload_images/24274-ff47e2ec1ab6b131.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![ç»„åˆæ–‡æœ¬æ¡†](http://upload-images.jianshu.io/upload_images/24274-dccccfa9e02bcab3.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
é¦–å…ˆè¯´æ˜çš„æ˜¯ï¼ŒiOS10 é€šçŸ¥ä¸Šçš„äº¤äº’åªæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ Button ä¸€ç§æ˜¯ textï¼Œå°±ç®—ä½¿ç”¨äº† iOS10 Notification Content Extension ä¹Ÿä¸èƒ½æ·»åŠ è‡ªå®šä¹‰çš„æŒ‰é’®æˆ–è€…å…¶ä»–äº¤äº’ç»„ä»¶ï¼Œå› ä¸ºä¸ä¼šå“åº”ã€‚

```
-(NSSet *)createNotificationCategoryActions{
    //å®šä¹‰æŒ‰é’®çš„äº¤äº’button action
    UNNotificationAction * likeButton = [UNNotificationAction actionWithIdentifier:@"see1" title:@"I love it~" options:UNNotificationActionOptionAuthenticationRequired|UNNotificationActionOptionDestructive|UNNotificationActionOptionForeground];
    UNNotificationAction * dislikeButton = [UNNotificationAction actionWithIdentifier:@"see2" title:@"I don't care~" options:UNNotificationActionOptionAuthenticationRequired|UNNotificationActionOptionDestructive|UNNotificationActionOptionForeground];
    //å®šä¹‰æ–‡æœ¬æ¡†çš„action
    UNTextInputNotificationAction * text = [UNTextInputNotificationAction actionWithIdentifier:@"text" title:@"How about it~?" options:UNNotificationActionOptionAuthenticationRequired|UNNotificationActionOptionDestructive|UNNotificationActionOptionForeground];
    //å°†è¿™äº›actionå¸¦å…¥category
    UNNotificationCategory * choseCategory = [UNNotificationCategory categoryWithIdentifier:@"seeCategory" actions:@[likeButton,dislikeButton] intentIdentifiers:@[@"see1",@"see2"] options:UNNotificationCategoryOptionNone];
    UNNotificationCategory * comment = [UNNotificationCategory categoryWithIdentifier:@"seeCategory1" actions:@[text] intentIdentifiers:@[@"text"] options:UNNotificationCategoryOptionNone];
    return [NSSet setWithObjects:choseCategory,comment,nil];
}
```

åœ¨ä¸Šé¢å°è£…äº†ä¸Šé¢ä¸¤å¼ å›¾ä¸­æ‰€ç¤ºçš„ä¸¤ä¸ª category ç»„åˆï¼Œæ¯ä¸€ä¸ª category æºå¸¦çš„ action å¦‚å›¾æ‰€ç¤ºï¼Œåœ¨é€šçŸ¥ä¸­å¿ƒåˆå§‹åŒ–çš„æ—¶å€™è®¾ç½® app è¦æ”¯æŒçš„ categoryã€‚

```
UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];
    [center setNotificationCategories:[self createNotificationCategoryActions]];
```

UNNotificationAction åœ¨åˆå§‹åŒ–çš„æ—¶å€™éœ€è¦å®šä¹‰ UNNotificationActionOptionsï¼Œè¿™ä¸ª UNNotificationActionOptions çš„æ„æ€æ˜¯ï¼š

```
typedef NS_OPTIONS(NSUInteger, UNNotificationActionOptions) {

    // Whether this action should require unlocking before being performed.
    //æŒ‡å®šè¯¥åŠ¨ä½œæ˜¯å¦éœ€è¦ç”¨æˆ·è§£é”éªŒè¯èº«ä»½
    UNNotificationActionOptionAuthenticationRequired = (1 << 0),

    // Whether this action should be indicated as destructive.
    //æŒ‡å®šç”¨æˆ·æ‰§è¡Œè¯¥åŠ¨ä½œæ˜¯å¦è¦å°†é€šçŸ¥ä»iOSçš„é€šçŸ¥ä¸­å¿ƒç§»é™¤ï¼Œä»¥é˜²æ­¢å¤„ç†è¿‡è¯¥é€šçŸ¥ä»¥åé‡å¤å¤„ç†
    UNNotificationActionOptionDestructive = (1 << 1),

    // Whether this action should cause the application to launch in the foreground.
    //æŒ‡å®šé€šçŸ¥actionç‚¹å‡»åæ˜¯å¦è¦è¿›å…¥appåˆ°å‰å°ï¼Œå¦‚æœåˆ°å‰å°ï¼Œè¿™ä¸ªå¯¹Notification Content Extensionçš„è‡ªå®šä¹‰çš„é€šçŸ¥UIæœ‰æ„ä¹‰ï¼Œ
    //å¯ä»¥åœ¨Extensionä¸­å¤„ç†ç”¨æˆ·çš„ç‚¹å‡»æˆ–è€…æäº¤æ–‡å­—ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŒ‡å®šè¯¥actionä¸éœ€è¦è¿›å…¥appï¼Œ
    //UNNotificationActionOptionAuthenticationRequiredè¿™ä¸ªå°±ä¸è¦åŠ å…¥
    UNNotificationActionOptionForeground = (1 << 2),
} __IOS_AVAILABLE(10.0) __WATCHOS_AVAILABLE(3.0) __TVOS_PROHIBITED;
```

æµ‹è¯•æˆ‘ä»¬é¢„è®¾å¥½çš„ category

```
-(void)timeLoacl{
    UNMutableNotificationContent *content = [[UNMutableNotificationContent alloc] init];
    content.title = @"\"Fly to the moon\"";
    content.subtitle = @"by Neo";
    content.body = @"the wonderful song with you~";
    content.badge = @0;
    NSString *path = [[NSBundle mainBundle] pathForResource:@"image1" ofType:@"png"];
    NSError *error = nil;
    UNNotificationAttachment *img_attachment = [UNNotificationAttachment attachmentWithIdentifier:@"att1" URL:[NSURL fileURLWithPath:path] options:nil error:&error];
    if (error) {
        NSLog(@"%@", error);
    }
    content.attachments = @[img_attachment];
    //è®¾ç½®ä¸º@""ä»¥åï¼Œè¿›å…¥appå°†æ²¡æœ‰å¯åŠ¨é¡µ
    content.launchImageName = @"";
    UNNotificationSound *sound = [UNNotificationSound defaultSound];
    content.sound = sound;

    UNTimeIntervalNotificationTrigger *time_trigger = [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:5 repeats:NO];
    NSString *requestIdentifer = @"time interval request";
//åœ¨æ­¤æŒ‡å®šé€šçŸ¥å†…å®¹çš„categoryIdentifierï¼Œå°±æ˜¯ä¸Šé¢æˆ‘ä»¬é¢„è®¾å¥½çš„categoryï¼Œä¸€ä¸ªcategoryä»£è¡¨ä¸€ç§äº¤äº’ç»„åˆç±»å‹
    content.categoryIdentifier = @"seeCategory1";
//    content.categoryIdentifier = @"seeCategory";
    UNNotificationRequest *request = [UNNotificationRequest requestWithIdentifier:requestIdentifer content:content trigger:time_trigger];

    [[UNUserNotificationCenter currentNotificationCenter] addNotificationRequest:request withCompletionHandler:^(NSError * _Nullable error) {
        NSLog(@"%@",error);
    }];
}
```

åœ¨ç‚¹å‡»æŸä¸ªæŒ‰é’®æˆ–è€…æ˜¯è¾“å…¥äº†æ–‡æœ¬åï¼Œä¼šåœ¨é€šçŸ¥ä¸­å¿ƒçš„ä»£ç†å›è°ƒå‡½æ•°é‡Œå¤„ç†äº¤äº’çš„ response

```
- (void)userNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(void(^)())completionHandler{
    //åœ¨æ­¤ï¼Œå¯åˆ¤æ–­responseçš„ç§ç±»å’Œrequestçš„è§¦å‘å™¨æ˜¯ä»€ä¹ˆï¼Œå¯æ ¹æ®è¿œç¨‹é€šçŸ¥å’Œæœ¬åœ°é€šçŸ¥åˆ†åˆ«å¤„ç†ï¼Œå†æ ¹æ®actionè¿›è¡Œåç»­å›è°ƒ
    if ([response isKindOfClass:[UNTextInputNotificationResponse class]]) {
        UNTextInputNotificationResponse * textResponse = (UNTextInputNotificationResponse*)response;
        NSString * text = textResponse.userText;
        //do something
    }
    else{
        if ([response.actionIdentifier isEqualToString:@"see1"]) {
            //I love it~çš„å¤„ç†
        }
        if ([response.actionIdentifier isEqualToString:@"see2"]) {
            //I don't care~
            [[UNUserNotificationCenter currentNotificationCenter] removeDeliveredNotificationsWithIdentifiers:@[response.notification.request.identifier]];
        }
    }
    completionHandler();
}
```

è¿™é‡Œéœ€è¦æ ¹æ® response çš„ç±»å‹æˆ–è€…æ ¹æ® actionIdentifier æ¥åŒºåˆ†ç”¨æˆ·çš„äº¤äº’ç»“æœæ¥å¤„ç†é€»è¾‘

#### iOS10 é€šçŸ¥é™„ä»¶ UNNotificationAttachmentï¼Œå±•ç¤ºå›¾ç‰‡ã€Gifã€Audio å’Œ Video

![gifé€šçŸ¥](http://upload-images.jianshu.io/upload_images/24274-9d468cf9c27dcbe5.gif?imageMogr2/auto-orient/strip)
![](iOSé‡Œçš„é€šçŸ¥ä¸æ¨é€/gifNotification.gif)

```
-(void)timeLoaclWithImage{
    UNMutableNotificationContent *content = [[UNMutableNotificationContent alloc] init];
    content.title = @"\"Fly to the moon\"";
    content.subtitle = @"by Neo";
    content.body = @"the wonderful song with you~";
    content.badge = @0;
    NSString *path = [[NSBundle mainBundle] pathForResource:@"image1" ofType:@"png"];
    NSError *error = nil;
    UNNotificationAttachment *img_attachment = [UNNotificationAttachment attachmentWithIdentifier:@"att1" URL:[NSURL fileURLWithPath:path] options:nil error:&error];
    if (error) {
        NSLog(@"%@", error);
    }
    content.attachments = @[img_attachment];
    //è®¾ç½®ä¸º@""ä»¥åï¼Œè¿›å…¥appå°†æ²¡æœ‰å¯åŠ¨é¡µ
    content.launchImageName = @"";
    UNNotificationSound *sound = [UNNotificationSound defaultSound];
    content.sound = sound;

    UNTimeIntervalNotificationTrigger *time_trigger = [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:5 repeats:NO];
    NSString *requestIdentifer = @"time interval request";
    content.categoryIdentifier = @"seeCategory1";
    UNNotificationRequest *request = [UNNotificationRequest requestWithIdentifier:requestIdentifer content:content trigger:time_trigger];

    [[UNUserNotificationCenter currentNotificationCenter] addNotificationRequest:request withCompletionHandler:^(NSError * _Nullable error) {
        NSLog(@"%@",error);
    }];
}
```

UNNotificationAttachment éœ€è¦æŒ‡å®š imageã€gifã€audio ä¸ video çš„æ–‡ä»¶è·¯å¾„ï¼Œ
`+ (nullable instancetype)attachmentWithIdentifier:(NSString *)identifier URL:(NSURL *)URL options:(nullable NSDictionary *)options error:(NSError *__nullable *__nullable)error;`
æ­¤å¤„æœ‰ä¸€ä¸ª options çš„å­—å…¸ï¼Œä¼ å…¥çš„ key æœ‰ä¸€ä¸‹å‡ ç‚¹ï¼š

```
// Key to manually provide a type hint for the attachment. If not set the type hint will be guessed from the attachment's file extension. Value must be an NSString.
extern NSString * const
//æŒ‡å®šæ–‡ä»¶ç±»å‹ï¼ŒæŸ¥çœ‹æ–‡æ¡£å¯ä»¥å‘ç°æ”¯æŒå“ªäº›æ–‡ä»¶
UNNotificationAttachmentOptionsTypeHintKey __IOS_AVAILABLE(10.0) __WATCHOS_AVAILABLE(3.0);

// Key to specify if the thumbnail for this attachment is hidden. Defaults to NO. Value must be a boolean NSNumber.
extern NSString * const
//æŒ‡å®šé€šçŸ¥ä¸Šæ˜¯å¦æ˜¾ç¤ºæ–‡ä»¶çš„ç¼©ç•¥å›¾
UNNotificationAttachmentOptionsThumbnailHiddenKey __IOS_AVAILABLE(10.0) __WATCHOS_AVAILABLE(3.0);

// Key to specify a normalized clipping rectangle to use for the attachment thumbnail. Value must be a CGRect encoded using CGRectCreateDictionaryRepresentation.
//æŒ‡å®šç¼©ç•¥å›¾çš„åˆ‡å‰²æ¯”ä¾‹
extern NSString * const UNNotificationAttachmentOptionsThumbnailClippingRectKey __IOS_AVAILABLE(10.0) __WATCHOS_AVAILABLE(3.0);

// Key to specify the animated image frame number or the movie time to use as the thumbnail.
// An animated image frame number must be an NSNumber. A movie time must either be an NSNumber with the time in seconds or a CMTime encoded using CMTimeCopyAsDictionary.
extern NSString * const
//å½±ç‰‡åˆ‡å‰²æ—¶é—´
UNNotificationAttachmentOptionsThumbnailTimeKey __IOS_AVAILABLE(10.0) __WATCHOS_AVAILABLE(3.0);
```

ä»ç½‘ä¸Šè·å– gif ä¸‹è½½åå±•ç¤º

```
-(void)timeLoaclWithGif{
    NSURLSessionConfiguration *config = [NSURLSessionConfiguration defaultSessionConfiguration];
    NSURLSession *session = [NSURLSession sessionWithConfiguration:config];
    NSURLSessionDataTask *task = [session dataTaskWithURL:[NSURL URLWithString:@"http://ww3.sinaimg.cn/large/006y8lVagw1faknzht671g30b408c1l2.gif"] completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) {
        if (!error) {
//ç¼“å­˜åˆ°tmpæ–‡ä»¶å¤¹
            NSString *path = [NSHomeDirectory() stringByAppendingPathComponent:[NSString stringWithFormat:@"tmp/%@att.%@",@([NSDate date].timeIntervalSince1970),@"gif"]];
            NSError *err = nil;
            [data writeToFile:path atomically:YES];
            UNNotificationAttachment *gif_attachment = [UNNotificationAttachment attachmentWithIdentifier:@"attachment" URL:[NSURL fileURLWithPath:path] options:@{UNNotificationAttachmentOptionsThumbnailClippingRectKey:[NSValue valueWithCGRect:CGRectMake(0, 0, 1, 1)]} error:&err];
            UNMutableNotificationContent *content = [[UNMutableNotificationContent alloc] init];
            content.title = @"\"Fly to the moon\"";
            content.subtitle = @"by Neo";
            content.body = @"the wonderful song with you~";
            content.badge = @0;
            NSError *error = nil;
            if (gif_attachment) {
                content.attachments = @[gif_attachment];
            }
            if (error) {
                NSLog(@"%@", error);
            }
            //è®¾ç½®ä¸º@""ä»¥åï¼Œè¿›å…¥appå°†æ²¡æœ‰å¯åŠ¨é¡µ
            content.launchImageName = @"";
            UNNotificationSound *sound = [UNNotificationSound defaultSound];
            content.sound = sound;

            UNTimeIntervalNotificationTrigger *time_trigger = [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:1 repeats:NO];
            NSString *requestIdentifer = @"time interval request";
            content.categoryIdentifier = @"seeCategory1";
            UNNotificationRequest *request = [UNNotificationRequest requestWithIdentifier:requestIdentifer content:content trigger:time_trigger];
            [[UNUserNotificationCenter currentNotificationCenter] addNotificationRequest:request withCompletionHandler:^(NSError * _Nullable error) {
                NSLog(@"%@",error);
            }];
        }
    }];
    [task resume];
}
```

åœ¨æ–‡ä»¶ç¼“å­˜ä»¥åï¼Œå‘èµ·æœ¬åœ°é€šçŸ¥ã€‚å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå½¢æˆ request å‘èµ·ä»¥åï¼Œå¦‚æœ URL æ‰€ä»£è¡¨çš„æ–‡ä»¶è¿‡å¤§ï¼Œæ‰“å¼€é€šçŸ¥çš„äº¤äº’ç•Œé¢çš„æ—¶å€™ä¼šéå¸¸æ…¢ï¼Œç”šè‡³æœ‰æ—¶å€™ä¼šå‡ºç°èµ„æºæ˜¾ç¤ºä¸å‡ºæ¥ï¼Œè¿˜æœ‰ä¸€ç‚¹æ˜¯ï¼Œå½“ä½ åœ¨é€šçŸ¥è§¦å‘å±•ç¤ºä»¥åï¼Œå†é€šè¿‡ request å–å‡º attachment æ–‡ä»¶çš„ URL çš„æ—¶å€™ï¼Œå‘ç° URL ç«Ÿç„¶å‘ç”Ÿäº†å˜åŒ–ï¼Œæ–‡ä»¶æ˜¯ç¼“å­˜åˆ°ä¸€ä¸ªå« pushstore çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œè¿™ä¸ªåœ¨åé¢ä»‹ç» Notification Service Extension ä¸ Notification Content Extension æ•°æ®å…±äº«çš„æ—¶å€™ä¼šè®¨è®ºè¯¥é—®é¢˜ã€‚

#### iOS10 Notification Service Extensionï¼š

Notification Service Extension æ˜¯ Xcode8 ä¸­åŠ å…¥ä¼—å¤š extension çš„å…¶ä¸­ä¸€ç§ï¼ŒExtension å®é™…ä¸Šæ˜¯ App æä¾›äº†ä¸€ä¸ªé¢å¤–æ’ä»¶åŠŸèƒ½ï¼Œä»¥ä¾› iOS æ“ä½œç³»ç»Ÿè°ƒç”¨ï¼Œä¸ App æ˜¯å®¿ä¸»å…³ç³»ã€‚
![Notification Service Extension target](http://upload-images.jianshu.io/upload_images/24274-90f28e2450f74f2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š
![Notification Service Extensionæµç¨‹](http://upload-images.jianshu.io/upload_images/24274-306540874ab65489.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
Notification Service Extension çš„ä½œç”¨ï¼š

1.  ä½¿å¾—æ¨é€çš„æ•°æ®åœ¨ iOS ç³»ç»Ÿå±•ç¤ºä¹‹å‰ï¼Œç»è¿‡ App å¼€å‘è€…çš„ Extensionï¼Œå¯ä»¥åœ¨ä¸å¯åŠ¨ App çš„æƒ…å†µä¸‹ï¼Œå®Œæˆä¸€äº›å¿«æ·æ“ä½œé€»è¾‘ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœä½ æ˜¯ä¸ªç¤¾äº¤ Appï¼Œå¯ä»¥åœ¨ä¸å¯åŠ¨ App çš„æƒ…å†µä¸‹ï¼Œç›´æ¥ç‚¹èµå›å¤ï¼Œè€Œä¸ç”¨æ‰“å¼€ Appï¼Œæé«˜æ•ˆç‡
2.  è™½ç„¶ iOS10 çš„æ¨é€æ•°æ®åŒ…å·²ç»è¾¾åˆ° 4kï¼Œä½†æ˜¯å¯¹äºä¸€äº›å›¾ç‰‡è§†é¢‘ gif è¿˜æ˜¯æ— åŠ›çš„ï¼Œæœ‰äº† Extensionï¼Œå¯ä»¥åœ¨æ­¤ä¸‹è½½å®Œæ¯•ç„¶åç›´æ¥å±•ç¤ºï¼Œä¸°å¯Œçš„å›¾ç‰‡å’Œè§†é¢‘å¯ä»¥åœ¨æ­¤æ˜¾ç¤º
3.  å¯ä»¥åœ¨æ­¤ Extension ä¸­å¦‚æœè¦å®Œæˆ 1 ä¸­æ‰€è¿°çš„ç”¨æˆ·è¡Œä¸ºæ“ä½œï¼Œåˆ™å¿…é¡»åŠ å¼ºå®‰å…¨æ€§ï¼ŒæœåŠ¡ç«¯å¯ä»¥å¯¹æ¨é€çš„æ•°æ®é…åˆ RSA ç®—æ³•ç”¨æœåŠ¡ç«¯çš„ç§é’¥åŠ å¯†ï¼Œåœ¨ Extension ä¸­ä½¿ç”¨æœåŠ¡ç«¯ç§é’¥è§£å¯†ï¼Œå…¶å® APNs ä» SSL æ•°å­—å®‰å…¨è¯ä¹¦åˆ° Json Web Token ä»¤ç‰Œï¼Œå·²ç»éå¸¸å®‰å…¨ï¼Œä½†æ˜¯å¤§é‡çš„ App ä½¿ç”¨ç¬¬ä¸‰æ–¹è¯¸å¦‚ JPush çš„æ¨é€æœåŠ¡ï¼Œæ¥è·Ÿ APNs äº¤äº’ï¼Œä¸šåŠ¡æ•°æ®è·‘åœ¨åˆ«äººçš„ç®¡é“ä¸Šï¼Œå½“ç„¶æœ‰æ‰€é¡¾å¿Œï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªåœ°æ–¹åŠ å¯†çš„æ›´å¤šç°å®æ„ä¹‰æ˜¯é˜²æ­¢ä¸šåŠ¡æ•°æ®è¢«ç¬¬ä¸‰æ–¹æœåŠ¡å•†çª¥æ¢ã€‚
    æ–°å»ºä¸€ä¸ª target
    ![addtarget_notification_service_extension](http://upload-images.jianshu.io/upload_images/24274-4d9603f2babb4789.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
    è¿™ç‚¹æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼ŒBundleID å°±æ˜¯å®¿ä¸» App çš„ BundleID.è¿™é‡Œè®¾ç½®çš„ ProductName ï¼Œè‡ªåŠ¨ç”Ÿæˆ
    æ³¨æ„ä½¿ç”¨ç»„ç»‡åä¸ team è¯ä¹¦ã€‚
    åœ¨æ–°ç”Ÿæˆçš„ NotificationService æ–‡ä»¶é‡Œæœ‰å¦‚ä¸‹æ–¹æ³•

```
 -(void)didReceiveNotificationRequest:(UNNotificationRequest *)request withContentHandler:(void (^)(UNNotificationContent * _Nonnull))contentHandler {
    self.contentHandler = contentHandler;
    self.bestAttemptContent = [request.content mutableCopy];
    self.bestAttemptContent.title =@"";
    // Modify the notification content here...
    NSDictionary * userInfo = request.content.userInfo;
    NSURLSessionConfiguration *config = [NSURLSessionConfiguration defaultSessionConfiguration];
    NSURLSession *session = [NSURLSession sessionWithConfiguration:config];
    //æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çº¦å®šå„ç§èµ„æºçš„urlï¼Œæ ¹æ®urlèµ„æºè¿›è¡Œä¸‹è½½
    NSString * imageUrl = [userInfo objectForKey:@"imageUrl"];
    NSString * gifUrl = [userInfo objectForKey:@"gifUrl"];
    NSString * typeString ;
    NSURL * url;
    if (imageUrl.length>0) {
        url = [NSURL URLWithString:imageUrl];
        typeString = @"jpg";
    }
    if (gifUrl.length>0) {
        url = [NSURL URLWithString:gifUrl];
        typeString = @"gif";
    }
    if (url) {
        NSURLRequest * urlRequest = [NSURLRequest requestWithURL:url cachePolicy:NSURLRequestUseProtocolCachePolicy timeoutInterval:5];
//æ³¨æ„ä½¿ç”¨DownloadTaskï¼Œè¿™ç‚¹ä¼šè¯¦ç»†è¯´æ˜
        NSURLSessionDownloadTask *task = [session downloadTaskWithRequest:urlRequest completionHandler:^(NSURL * _Nullable location, NSURLResponse * _Nullable response, NSError * _Nullable error) {
            if (!error) {
                NSString *path = [location.path stringByAppendingString:[NSString stringWithFormat:@".%@",typeString]];
                NSError *err = nil;
                NSURL * pathUrl = [NSURL fileURLWithPath:path];
                [[NSFileManager defaultManager] moveItemAtURL:location toURL:pathUrl error:nil];
//ä¸‹è½½å®Œæ¯•ç”Ÿæˆé™„ä»¶ï¼Œæ·»åŠ åˆ°å†…å®¹ä¸­
                UNNotificationAttachment *resource_attachment = [UNNotificationAttachment attachmentWithIdentifier:@"attachment" URL:pathUrl options:nil error:&err];
                if (resource_attachment) {
                    self.bestAttemptContent.attachments = @[resource_attachment];
                }
                if (error) {
                    NSLog(@"%@", error);
                }
                //è®¾ç½®ä¸º@""ä»¥åï¼Œè¿›å…¥appå°†æ²¡æœ‰å¯åŠ¨é¡µ
                self.bestAttemptContent.launchImageName = @"";
                UNNotificationSound *sound = [UNNotificationSound defaultSound];
                self.bestAttemptContent.sound = sound;
//å›è°ƒç»™ç³»ç»Ÿ
                self.contentHandler(self.bestAttemptContent);
            }
            else{
                self.contentHandler(self.bestAttemptContent);
            }
        }];
        [task resume];
    }
    else{
        self.contentHandler(self.bestAttemptContent);
    }
}

- (void)serviceExtensionTimeWillExpire {
    // Called just before the extension will be terminated by the system.
    // Use this as an opportunity to deliver your "best attempt" at modified content, otherwise the original push payload will be used.
    self.contentHandler(self.bestAttemptContent);
}
```

WWDC2016 ä¸Šçš„ä¿„ç½—æ–¯å£éŸ³å°ä¼™ä¸Šå°è®² Notification Service Extension çš„æ—¶å€™ï¼Œæ˜ç¡®æåˆ°äº†â€You will get a short execution time, which means this is not for long background running tasks.â€œï¼Œä½†å®é™…æµ‹è¯•è¿‡ç¨‹ä¸­ï¼ŒNotification Service Extension éå¸¸å®¹æ˜“å´©æºƒ crash å’Œå†…å­˜æº¢å‡º out of memoryã€‚
**æ›´åŠ å‘çš„æ˜¯ debug è¿è¡Œçš„æ—¶å€™å’ŒçœŸæœºè¿è¡Œçš„æ—¶å€™ï¼ŒNotification Service Extension æ€§èƒ½è¡¨ç°æ˜¯ä¸ä¸€æ ·çš„ï¼ŒçœŸæœºè¿è¡Œçš„æ—¶å€™ Notification Service Extension éå¸¸å®¹æ˜“ä¸èµ·ä½œç”¨ï¼Œæˆ‘åšäº†å‡ æ¬¡å®éªŒï¼Œå›¾ç‰‡ç¨å¤§ï¼ŒNotification Service Extension å°±å´©æºƒäº†ä¸èµ·ä½œç”¨äº†ï¼Œè€Œç›¸åŒçš„ debug è°ƒè¯•ç¯å¢ƒä¸‹åˆ™æ²¡é—®é¢˜ï¼Œæˆ‘è§‰å¾—ä»–åº”è¯¥ä¹Ÿææè¿™ä¸ªï¼Œæ¯”å¦‚è¯´ä½ ä¸‹è½½èµ„æºçš„æ—¶å€™æœ€å¥½åˆ†æ®µç¼“å­˜ä¸‹è½½ï¼ŒçœŸæœºç¯å¢ƒä¸‹ NSURLSessionDataTask ä¸‹è½½æ•°æ®ä¸å¥½ä½¿ï¼Œå¿…é¡»ä½¿ç”¨ NSURLSessionDownloadTask æ‰å¯ä»¥ï¼Œè¿™ç‚¹å¾ˆæ— å¥ˆ**ã€‚

#### iOS10 Notification Content Extension:

![è‡ªå®šä¹‰é€šçŸ¥UI](http://upload-images.jianshu.io/upload_images/24274-dd861df4c56fb3b4.gif?imageMogr2/auto-orient/strip)
Notification Content Extension æ˜¯å¦å¤–ä¸€ä¸ªæ‰©å±•ï¼Œå…¶å†…å®¹ä½¿ç”¨äº† UserNotificationsUIFrameworkï¼Œé¦–å…ˆè¿˜æ˜¯åˆ›å»º Notification Content Extension çš„ targetã€‚
![Notification Content Extension](http://upload-images.jianshu.io/upload_images/24274-ed40c262cb44033a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
æ­¤æ—¶ä¼šå¾—åˆ° Notification Content Extension ä¸ MainInterfaceï¼Œsto
ryboard é‡Œé¢å«æœ‰ä¸€ä¸ªè¯•å›¾æ§åˆ¶å™¨ï¼Œè¿™ä¸ªè¯•å›¾æ§åˆ¶å™¨å°±æ˜¯ Notification ç‚¹å‡»åä¸­é—´æ˜¾ç¤ºçš„é‚£éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†ä½ å¯ä»¥è‡ªå®šä¹‰ UIï¼Œæ³¨æ„çš„æ˜¯è¯¥è§†å›¾æ§åˆ¶å™¨æ— æ³•å“åº”äº¤äº’æ§ä»¶ï¼Œè¦æƒ³ä½¿ç”¨äº¤äº’ç»„ä»¶ï¼Œå°±å¿…é¡»é…åˆ UNNotificationAction å’Œ category æ¥å¯¹åº”ä½ çš„ UI éƒ¨åˆ†ï¼Œè¿˜æœ‰ä¸€ç‚¹ï¼ŒNotification Content Extension åªèƒ½æœ‰ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œæ‰€ä»¥ä½ è¦æƒ³å®šåˆ¶å¤šç§ UIï¼Œå°±éœ€è¦ä»£ç åˆ¤æ–­åŠ è½½ä¸åŒçš„ View æ¥å®ç°ã€‚
![è‡ªå®šä¹‰UIéƒ¨åˆ†.png](http://upload-images.jianshu.io/upload_images/24274-e81d9d37123e5a88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
åœ¨è§†å›¾æ§åˆ¶å™¨éƒ¨åˆ†ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
- (void)didReceiveNotification:(UNNotification *)notification {
    self.label.text = notification.request.content.body;
    UNNotificationAttachment * attachment = notification.request.content.attachments.firstObject;
    if (attachment) {
        //å¼€å§‹è®¿é—®pushStoreçš„å­˜å‚¨æƒé™
        [attachment.URL startAccessingSecurityScopedResource];
        NSData * data = [NSData dataWithContentsOfFile:attachment.URL.path];
        [attachment.URL stopAccessingSecurityScopedResource];
        self.imageView.image = [UIImage imageWithData:data];
    }
}
- (void)didReceiveNotificationResponse:(UNNotificationResponse *)response completionHandler:(void (^)(UNNotificationContentExtensionResponseOption option))completion;{
    if ([response isKindOfClass:[UNTextInputNotificationAction class]]) {
        //å¤„ç†æäº¤æ–‡æœ¬çš„é€»è¾‘
    }
    if ([response.actionIdentifier isEqualToString:@"see1"]) {
        //å¤„ç†æŒ‰é’®3
    }
    if ([response.actionIdentifier isEqualToString:@"see2"]) {
        //å¤„ç†æŒ‰é’®2
    }
    //å¯æ ¹æ®actionçš„é€»è¾‘å›è°ƒçš„æ—¶å€™ä¼ å…¥ä¸åŒçš„UNNotificationContentExtensionResponseOption
    completion(UNNotificationContentExtensionResponseOptionDismiss);
}
```

åŠ å…¥ä½ æœ‰äº† Service Extension åœ¨å‰é¢ä¸‹è½½å¥½äº†å›¾ç‰‡æˆ–è€…æ˜¯è§†é¢‘ï¼Œåœ¨è‡ªå®šä¹‰ UI éƒ¨åˆ†ä½ æƒ³è·å–ï¼Œå°±å¯ä»¥é€šè¿‡ UNNotificationAttachment \* attachment = notification.request.content.attachments.firstObject;æŸ¥æ‰¾é™„ä»¶æ¥è·å–æ•°æ®ï¼Œä½†æ˜¯å¿…é¡»æ³¨æ„ï¼Œå‰é¢æåˆ°çš„æ˜¯ï¼Œå½¢æˆé™„ä»¶åï¼Œæ–‡ä»¶çš„å®é™…å­˜å‚¨è¢«ç§»åˆ°äº† pushStore çš„ä¸€ä¸ªç³»ç»Ÿçº§åˆ«çš„ç¼“å­˜æ–‡ä»¶å¤¹ï¼Œæ­¤æ—¶éœ€è¦è°ƒç”¨ NSURL åœ¨ iOS8 å¼€å§‹æä¾›çš„ä¸¤ä¸ªæ–¹æ³•æ¥è·å–æƒé™ï¼Œæå–æ•°æ®ã€‚
`startAccessingSecurityScopedResource`
`stopAccessingSecurityScopedResource`
ç‚¹å‡»æŒ‰é’®åï¼Œå›è°ƒçš„æ–¹æ³•æ˜¯ didReceiveNotificationResponseï¼Œåœ¨å‰é¢å·²ç»æ¼”ç¤ºè¿‡ï¼Œåœ¨è¿™ï¼Œå¯ä»¥ä¸ç”¨æ‰“å¼€ App è¿›è€Œå®Œæˆä¸€äº›äº¤äº’åŠ¨ä½œã€‚
Info.plist æ–‡ä»¶æœ‰ä¸€äº›è®¾ç½®éœ€è¦è¡¨æ˜
![Info.plistè®¾ç½®](http://upload-images.jianshu.io/upload_images/24274-133fbc507983594e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

1.  UNNotificationExtensionCategory æ”¹æˆæ•°ç»„ï¼Œå°†ä½ è‡ªå®šä¹‰çš„ UI æ”¯æŒçš„ categoryIdentifier ä¸€ä¸€æ”¾ä¸Šï¼Œè¿™æ ·ï¼ŒAPNs æ¨è¿‡æ¥çš„æ•°æ®ä¸­ category åŒ…å«å“ªä¸ªå€¼ï¼Œå°±è°ƒç”¨å“ªä¸ª UNNotificationCategory è®¾ç½®å¥½çš„ actions äº¤äº’ç»„åˆ
2.  UNNotificationExtensionInitialContentSizeRatioï¼Œè‡ªå®šä¹‰å†…å®¹çš„é«˜åº¦ä¸å®½åº¦çš„æ¯”å€¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨ ViewDidLoad ä¸­ä¿®æ”¹ preferredContentSize æ¥å®Œæˆè¿™ä¸€ç›®æ ‡
3.  UNNotificationExtensionDefaultContentHiddenï¼Œå†³å®šæ˜¯å¦åœ¨è‡ªå®šä¹‰ UI ä¸‹éƒ¨æ˜¾ç¤ºé€šçŸ¥çš„åŸå†…å®¹ï¼Œé»˜è®¤æ˜¯æ˜¾ç¤º

#### Extensions æ•°æ®å…±äº«ï¼š

ServiceExtension ä¸ ContentExtension é…åˆä½¿ç”¨æ˜¯éå¸¸æ£’çš„ç»„åˆï¼Œåœ¨ ServiceExtension ä¸­é¢„å…ˆä¸‹è½½å¥½æ•°æ®ï¼Œç”¨æˆ·ç‚¹å‡»ååœ¨ ContentExtension ä¸­ç›´æ¥å±•ç¤ºï¼Œè¿™æ ·äº¤äº’ä¼šæ¯”è¾ƒæµç•…ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚æœä½ æƒ³åœ¨ä¸æ‰“å¼€ App çš„æ—¶å€™ä½¿ç”¨è‡ªå®šä¹‰çš„ action æ¥ä¸ç”¨æˆ·äº¤äº’ï¼Œå°±å¿…é¡»åŠ  ContentExtensionï¼Œå› ä¸ºåªæœ‰å®ƒèƒ½æ¥æ”¶ç”¨æˆ·ç‚¹å‡» action çš„ responseï¼ŒServiceExtension æ˜¯æ²¡æœ‰çš„ã€‚
å¦‚æœä½ æƒ³ä½¿ä½ çš„ App åœ¨æ‰“å¼€çš„æ—¶å€™è®¿é—®åˆ°è¿™äº›æ•°æ®ï¼ŒåŒæ ·å¯ä»¥æ ¹æ® UNNotificationAttachment æ¥æŸ¥æ‰¾ï¼Œä½†æ˜¯æ›´å¥½çš„æ–¹æ¡ˆæˆ‘ä¸ªäººè§‰å¾—å¯ä»¥æ˜¯ç”¨ App Group æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå½“ç„¶ App Group çš„è¿‡å¤šè®¨è®ºæ˜¯åç¦»æœ¬æ–‡ç« çš„è¯é¢˜çš„ã€‚

#### åŠ¨æ€é…ç½®é€šçŸ¥äº¤äº’ï¼š

ä¸Šé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒNotification å¯ä»¥é…ä¸Šå¾ˆå¤š category ä¸ action æ¥è‡ªå®šä¹‰äº¤äº’æ–¹å¼ï¼Œä½†éƒ½æ˜¯ç¡¬ç¼–ç æ¥å®ç°ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬æƒ³è®©æŸä¸ª actionIdentifier å¯¹åº”çš„æŒ‰é’®æ–‡å­—æ”¹å˜ä¸€ä¸‹ï¼Œæˆ–è€…æ˜¯æŸä¸ª category å¯¹åº”çš„ actions æ”¹å˜ä¸€ä¸‹ï¼Œæ¥æ»¡è¶³è¿è¥æ´»åŠ¨çš„çµæ´»æ€§ï¼Œéœ€è¦æ€è€ƒåŠ¨æ€é…ç½® UNNotificationCategory å’Œ UNNotificationAction çš„é—®é¢˜ã€‚æœ‰å¦‚ä¸‹è¿™ä¸ªæ–¹æ¡ˆï¼Œå¯ä»¥æŠŠ UNNotificationCategory å’Œ UNNotificationAction åšæˆé…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š

```
{
	 "NotificationConfig": {
        "UNNotificationCategory": {
            "seeCategory": {
                "identifier": "seeCategory",
                "actions": ["see1","see2"],
                "options": 0
            }
        },
        "UNNotificationAction": {
            "see1": {
                "identifier": "see1",
                "title": "I love it~",
                "options": 4
            },
			"see2": {
                "identifier": "see2",
                "title": "I dont't care~",
                "options": 4
            }
        }
    }
}
```

ç„¶ååœ¨é€šçŸ¥ä¸­å¿ƒè®¾ç½® categorys çš„æ—¶å€™

```
-(NSSet *)createNotificationCategoryActions{
    if (HBCONFIGOBJECT.moduleConfig.userNotificationConfig) {
      //è¯»å–jsonæ–‡ä»¶
        NSDictionary * notificationConfig;
		NSDictionary * UNNotificationCategorys =[notificationConfig objectForKey:@"UNNotificationCategory"];
        NSDictionary * UNNotificationActions = [notificationConfig objectForKey:@"UNNotificationAction"];
        NSMutableSet * set = [NSMutableSet set];
        for (NSString * categoryKey in UNNotificationCategorys.allKeys) {
            NSDictionary * cateDict = UNNotificationCategorys[categoryKey];
            NSString * cateId = [cateDict objectForKey:@"identifier"];
            NSArray * cateActions = [cateDict objectForKey:@"actions"];
            NSNumber * cateOptions = [cateDict objectForKey:@"options"];
            NSMutableArray * actionsArr = [[NSMutableArray alloc]init];
            for (NSString * actionKey in cateActions) {
                NSDictionary * actionDict = [UNNotificationActions objectForKey:actionKey];
                if (actionDict) {
                    NSString * actionId = [actionDict objectForKey:@"identifier"];
                    NSString * actionTitle = [actionDict objectForKey:@"title"];
                    NSNumber * actionOption = [actionDict objectForKey:@"options"];
                    UNNotificationAction * action = [UNNotificationAction actionWithIdentifier:actionId title:actionTitle options:actionOption.unsignedIntegerValue];
                    [actionsArr addObject:action];
                }
            }
            UNNotificationCategory * category = [UNNotificationCategory categoryWithIdentifier:cateId actions:actionsArr intentIdentifiers:cateActions options:cateOptions.unsignedIntegerValue];
            [set addObject:category];
        }
        return set;
    }
    else
    {
        return nil;
    }
}
```

è¿™æ ·å°±å¯ä»¥ä»»æ„ç»„åˆ category å’Œ actions äº†ï¼Œjson æ–‡ä»¶å¯ä»¥åœ¨ App å†…éƒ¨åšå…¨é‡æ›´æ–°ï¼Œåœ¨è¿è¥æ´»åŠ¨ä¹‹å‰ï¼Œå°±ä¸‹å‘å¥½ç»™å®¢æˆ·ç«¯ã€‚
æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼ŒContentExtension éœ€è¦åœ¨ plist é‡ŒæŒ‡å®š categoryï¼Œæ‰€ä»¥å»ºè®®å°† categoryIdentifier æŒ‰ç…§ä¸€å®šæ ¼å¼è¿›è¡Œåºåˆ—åŒ–å–åï¼Œåœ¨ ContentExtension æå‰å†™å…¥ 0-10 ç­‰å¾ˆå¤šçš„ categoryï¼Œæ–¹é¢åŠ¨æ€é…ç½®çš„æ—¶å€™å–ç”¨ã€‚

#### è¿è¥å¦‚ä½•ä½¿ç”¨é€šçŸ¥ä¸æ¨é€ï¼š

![Instagramä¸ŠiOS10é€šçŸ¥çš„ä½¿ç”¨](http://upload-images.jianshu.io/upload_images/24274-297ea6c1fd89b7f5.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
iOS10 æ¨å‡ºäº†ååˆ†å‡ºè‰²çš„é€šçŸ¥ä»¥åï¼Œæˆ‘ç»å¸¸ä½¿ç”¨çš„ Instagramã€Twitterã€Facebook ç­‰éƒ½åŠæ—¶è·Ÿè¿›ï¼Œåšå‡ºäº†éå¸¸å¥½çš„äº¤äº’ï¼Œæˆ‘å¸Œæœ›å¾®ä¿¡å›¢é˜Ÿèƒ½åœ¨é€šçŸ¥ä¸Šå¿«é€Ÿé¢„è§ˆå†…å®¹å’Œå›å¤ä¸Šé¢å¢åŠ æ­¤åŠŸèƒ½ã€‚
å…¶å®ï¼Œè¿™ä¸ªè¯é¢˜æ˜¯æˆ‘éå¸¸æƒ³è®¨è®ºçš„ï¼Œä½œä¸ºå·¥ç¨‹å¸ˆï¼Œæœ‰å¾—å¤©ç‹¬åšçš„æ¡ä»¶æ·±åˆ»ç†è§£æœ€æ–°æœ€å‰æ²¿çš„æŠ€æœ¯ï¼Œé‚£ä¹ˆï¼Œè¿™äº›æŠ€æœ¯å¦‚ä½•äº§ç”Ÿç°å®æ„ä¹‰ï¼Œå¦‚ä½•ä½¿ç”¨ï¼Œåœ¨è¿™ç‚¹ä¸Šï¼Œå·¥ç¨‹å¸ˆæ˜¯éå¸¸å…·æœ‰ä¼˜åŠ¿çš„ï¼Œå‡å¦‚ä½ äº†è§£ç¡…è°·çš„å·¥ç¨‹å¸ˆæ–‡åŒ–ï¼Œä½ å°±ä¼šå‘ç°ï¼Œç¡…è°·çš„ç§‘æŠ€å…¬å¸å¾ˆå°‘æœ‰äº§å“ç»ç†çš„ï¼Œå¤§éƒ¨åˆ†å‡ºè‰²çš„åŠŸèƒ½å’Œä¼˜è´¨çš„ç”¨æˆ·ä½“éªŒæ˜¯ç”±å·¥ç¨‹å¸ˆæ‰“é€ çš„ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ MacTalk çš„ä¸€ç¯‡æ–‡ç«  [ã€Šç¡…è°·ä¸éœ€è¦äº§å“ç»ç†ã€‹](http://mp.weixin.qq.com/s/s-ads_wgo2wHkZ3Q8_f0vw)ã€‚
çœŸæ­£çš„å·¥ç¨‹å¸ˆæ–‡åŒ–ï¼Œä¸åƒå›½å†…çš„å¼€å‘è€…è®¤ä¸ºçš„æ˜¯åœ¨æŸä¸€æŠ€æœ¯é¢†åŸŸéå¸¸æ·±çš„ç†è®ºç ”ç©¶ï¼Œåœ¨å›½å¤–çš„å¼€å‘è€…çœ¼é‡Œï¼ŒçœŸæ­£çš„å·¥ç¨‹å¸ˆæ–‡åŒ–æ˜¯ä¸€ç¾¤å–„äºåˆ›é€ å¹¶ä¸”æœ‰å·¨å¤§çš„æ”¹å˜ç°å®ä¸–ç•Œçš„èƒ½åŠ›çš„å·¥ç¨‹å¸ˆæ–‡åŒ–ï¼Œè¯è¯´å›æ¥ï¼Œç°å¦‚ä»Šï¼Œç§»åŠ¨ç«¯çš„å·¥ç¨‹å¸ˆå¾ˆå¤šå¾ˆå¤šï¼Œåƒæœ¬ç¯‡è¿™æ ·çš„æŠ€æœ¯ä»‹ç»ç±»çš„æ–‡ç« æ•°ä¸èƒœæ•°ï¼ŒæŠ€æœ¯æ°´å¹³å·®ä¸å¤šçš„å·¥ç¨‹å¸ˆéå¸¸ä¹‹å¤šï¼Œä½ å¦‚ä½•è„±é¢–è€Œå‡ºï¼Ÿè¿™æ˜¯ä½ éœ€è¦æ€è€ƒçš„ï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼Œä½œä¸ºå·¥ç¨‹å¸ˆï¼Œè·Ÿä½ ä¸€æ ·ç†Ÿæ‚‰ API å’Œå¼€å‘æŠ€æœ¯çš„äººå¤šäº†å»äº†ï¼Œä½†æ˜¯å¦‚æœä½ èƒ½çŸ¥é“æŠ€æœ¯åœ¨å„ç§åœºæ™¯ä¸‹çš„æœ€ä½³ä½¿ç”¨æ–¹æ¡ˆï¼Œå¹¶ä¸”èƒ½åˆ‡å®æ”¹å˜ç°å®æƒ…å†µï¼Œä¸¾ä¸ªï¼ŒiOS10 çš„é€šçŸ¥ä½ æ˜¯äº†è§£ï¼Œä½†æ€ä¹ˆç”¨æ‰èƒ½æ›´å¥½çš„æå‡ä½ çš„ App çš„ç”¨æˆ·ä½“éªŒï¼Ÿæ›´å¥½çš„æé«˜ä½ çš„ App åœ¨æŸäº›åŠŸèƒ½åœºæ™¯ä¸‹çš„ç”¨æˆ·ä½¿ç”¨æˆæœ¬ï¼Ÿæ€ä¹ˆæ ·æ‰èƒ½è®©è¿è¥æ´»åŠ¨é€šè¿‡é€šçŸ¥æé«˜æ´»è·ƒåº¦ï¼Ÿå¦‚æœä½ æœ‰è¿™æ ·çš„å„ç§è§£å†³æ–¹æ¡ˆï¼Œä½ å°±æ˜¯èƒœå‡ºè€…~æ¯”æ–¹è¯´ï¼Œä½ æ˜¯ç¤¾äº¤ç±» App çš„å¼€å‘è€…ï¼Œä½ æœ‰ä¸€å †æŠ€æœ¯è§£å†³æ–¹æ¡ˆåœ¨æ‰‹ï¼Œèƒ½å¤Ÿåˆ‡å®æå‡ç”¨æˆ·ä½“éªŒçš„ï¼Œä½ æ˜¯ç”µå•†ç±»å¼€å‘è€…ï¼Œä½ æœ‰é€šçŸ¥çš„æŠ€æœ¯ä½¿ç”¨è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿæ›´å¥½çš„æ”¯æ’‘è¿è¥æ´»åŠ¨çš„ã€‚
é‚£ iOS10 çš„é€šçŸ¥èƒ½æƒ³åˆ°å“ªäº›ä½¿ç”¨åœºæ™¯å‘¢ï¼Ÿ

1.  è¿è¥æ´»åŠ¨å¯ä»¥é…ä¸Šæ´»åŠ¨æµ·æŠ¥æˆ–è€…æ˜¯åŠ¨å›¾æµ·æŠ¥ï¼Œåœ¨ç”¨æˆ·ç‚¹å‡»å¥½èƒ½æ›´å¥½çš„æŸ¥çœ‹è¿è¥æ´»åŠ¨è¯¦æƒ…
2.  å³æ—¶é€šè®¯ç±»çš„ App å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ ContentExtension æ¥åœ¨é€šçŸ¥ä¸Šå®Œæˆå›å¤æ¶ˆæ¯
3.  æ¯”æ–¹è¯´ï¼Œä½ æœ‰ä¸ªç§’æ€æ´»åŠ¨ï¼Œé€šçŸ¥ä¸€ä¸‹æ¥ï¼Œç”¨æˆ·ç«‹é©¬å¯ä»¥é€šè¿‡ iOS10 çš„é€šçŸ¥äº¤äº’å®Œæˆç§’æ€é¢„å®šï¼Œç„¶åå†å¯åŠ¨ App æ…¢æ…¢ä»˜æ¬¾~è¿™ä¸ªç”¨æˆ·ä½“éªŒçš„æå‡é‚£æ˜¯ç›¸å½“å·¨å¤§çš„
4.  æ¯”æ–¹è¯´ï¼Œä½ å¯ä»¥é€šè¿‡æ¨é€æ”¶å–ä¸€äº›ç”¨æˆ·å¯¹æŸä¸ªæ´»åŠ¨æˆ–è€…æ–°ç‰ˆæœ¬çš„åé¦ˆæ„è§ï¼Ÿä½¿ç”¨ TextAction æ¥åš
5.  ä½ æ˜¯å¦å¯å¯ä»¥å‘ä¸ªå¯è§†åŒ–çš„è´¦å•ç»™ç”¨æˆ·ï¼Œåœ¨è‡ªå®šä¹‰ UI ä¸Šæ˜¾ç¤ºï¼Ÿ
    â€¦â€¦
    å†æ¥è¯´è¯´æŠ€æœ¯æ–¹æ¡ˆå§ï¼Œä¸Šé¢çš„åœºæ™¯è¦æƒ³å®ç°ï¼Œæœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œé€šçŸ¥çš„ ServiceExtension å’Œ ContentExtension æ‹¿åˆ°äº†ç”¨æˆ·åé¦ˆçš„ä¿¡æ¯ï¼Œé‚£è¿™äº›ä¿¡æ¯è¯¥æ€ä¹ˆåŠ~æ–¹æ¡ˆå¦‚ä¸‹ï¼š
    ![æœ€æ–°é€šçŸ¥äº¤äº’æ–¹æ¡ˆ](http://upload-images.jianshu.io/upload_images/24274-3690a73508597f11.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
    è¿™æ˜¯ä¸ªç®€å•çš„å•æ¨äº¤äº’æ–¹æ¡ˆï¼Œå…¶ä¸­éœ€è¦ç”±åŠ¨æ€åŒ–é…ç½® Category ä¸ actions æ”¯æ’‘ï¼ŒåŒæ—¶è¦åšå¥½åŠ è§£å¯†å·¥ä½œã€‚
    ä»¥ä¸Šï¼Œå°±æ˜¯æœ¬æ¬¡è®¨è®ºé€šçŸ¥å’Œæ¨é€çš„ä¸»è¦å†…å®¹

#### ç•ªå¤–ï¼šæ¨æ‹‰ç»“åˆä¸ Web Service Push

//ç•ªå¤–ç¯‡å¾…è¡¥å…¨
12.24
æ›´æ–°ï¼š
Demo åœ°å€:https://github.com/Neojoke/UntificationLearn
å¯ä»¥ä½¿ç”¨å·¥å…·æ¥æµ‹è¯•æ¨é€ï¼Œå·¥å…·åœ°å€ï¼š
https://github.com/noodlewerk/NWPusher
éå¸¸æ–¹ä¾¿~
Enjoy~
