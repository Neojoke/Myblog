---
title: iOSåŠ¨åŠ¹-åˆ©ç”¨POPåŠ¨ç”»å®ç°å¡ç‰‡åˆ‡æ¢åŠ¨ç”»
date: 2015-07-02 00:18:00
categories:
- è¡¨-iOSç•Œé¢å¼€å‘åº”ç”¨
tags:
- iOS
- UI
---

![POP](https://upload-images.jianshu.io/upload_images/24274-ab6611386cda6f71.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240/q/100)

> Pop is an extensible animation engine for iOS and OS X. In addition to basic static animations, it supports spring and decay dynamic animations, making it useful for building realistic, physics-based interactions.
> The API allows quick integration with existing Objective-C codebases and enables the animation of any property on any object.
> It's a mature and well-tested framework that drives all the animations and transitions in Paper.

ä»¥ä¸Šæ˜¯ pop åŠ¨ç”»åœ¨ github ä¸Šçš„å®˜æ–¹è§£é‡Šï¼Œå¤§ä½“ä¸Šçš„æ„æ€æ˜¯ pop æ˜¯ä¸€ä¸ª extensibleï¼ˆå¯æ‰©å±•ï¼‰çš„åŠ¨ç”»å¼•æ“ï¼Œæä¾›åŸºç¡€çš„ Basic é™æ€åŠ¨ç”»ä»¥åŠæ”¯æŒå¼¹ç°§å’Œè¡°å‡åŠ¨ç”»ï¼Œç”¨æ¥æ„å»ºé«˜å¯ç”¨æ€§çš„çœŸå®ã€ç‰©ç†ç‰¹æ€§çš„äº¤äº’ä½“éªŒï¼Œä½¿ç”¨ oc ä½œä¸ºåŸºç¡€ï¼Œå¯ç”¨æˆ·æ‰©å±•åˆ°ä»»ä½•çš„ oc çš„ Object çš„å±æ€§ï¼Œæ˜¯ä¸€ä¸ªéå¸¸æ˜“äºæµ‹è¯•çš„æ¡†æ¶ï¼Œå¹¶ä¸”åœ¨ Facebook è‡ªå®¶çš„ Paper ä¸Šåº”ç”¨ã€‚

pop é¦–å…ˆæ˜¯ä¸€ä¸ªåŠ¨ç”»å¼•æ“ï¼Œé‚£æœ¬è´¨ä¸Šä¸å†æ˜¯åŸºäº apple çš„ CoreAnimation æ¡†æ¶çš„ï¼Œæ˜¯è‡ªå·±å®ç°çš„ä¸€å¥—è·Ÿ CoreAnimation ä¸€æ ·çš„åŠ¨ç”»å¼•æ“æ¡†æ¶ï¼Œå†…éƒ¨ä½¿ç”¨äº† CADisplayer çš„æ¯ç§’ 60 å¸§é«˜ç´ è´¨çš„æ¸²æŸ“æŠ€æœ¯ï¼Œå……åˆ†ä½¿ç”¨äº† GPU çš„èƒ½åŠ›ï¼Œæ€§èƒ½è¡¨ç°å¾ˆä¹è§‚ï¼Œè€Œèƒ½ç”¨ä½œä»»ä½•åŸºäº NSObject ä¸Šï¼Œåˆå¢åŠ äº†æ‰©å±•æ€§ï¼Œæ¯”å¦‚è¯´ UIView èƒŒæ™¯é¢œè‰²çš„åŠ¨æ€åˆ‡æ¢ï¼Œæ¯”å¦‚è¯´å£°éŸ³çš„æ¸éšæ¸æ˜¾ç­‰ç­‰ï¼Œè¿™æ˜¯å¯¹ CA ä¸è¶³çš„å……åˆ†è¡¥å……ï¼Œè€Œå¼•å‡ºçš„ physics ç‰¹æ€§ï¼Œæ›´å¼•å‘äº† apple åæ¥æ¨å‡ºäº† UIDynamic(UIKit åŠ¨åŠ›å­¦)æ¥å¼¥è¡¥ iOS å¹³å°ä¸Šçš„ç‰©ç†ç‰¹æ€§åŠ¨ç”»çš„ä¸è¶³ï¼Œä¹Ÿå¤§å¤§ç®€åŒ–äº†åŠ¨ç”»çš„å¼€å‘éš¾åº¦ã€‚POP ä½¿ç”¨ Objective-C++ ç¼–å†™ï¼ŒObjective-C++ æ˜¯å¯¹ C++ çš„æ‰©å±•ï¼Œå°±åƒ Objective-C æ˜¯ C çš„æ‰©å±•ã€‚è€Œè‡³äºä¸ºä»€ä¹ˆä»–ä»¬ç”¨ Objective-C++ è€Œä¸æ˜¯çº¯ç²¹çš„ Objective-Cï¼ŒåŸå› æ˜¯ä»–ä»¬æ›´å–œæ¬¢ Objective-C++ çš„è¯­æ³•ç‰¹æ€§æ‰€æä¾›çš„ä¾¿åˆ©ã€‚é‚£æˆ‘ä»¬å¼„æ¸…æ¥šäº† pop çš„æœ¬è´¨ï¼Œå°±å¼€å§‹ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæ¡†æ¶ã€‚

åŸºæœ¬çš„ pop åŠ¨ç”»çš„ä½¿ç”¨æˆ‘å°±ä¸å†èµ˜è¿°ï¼Œå¾ˆå¤šæ–‡ç« éƒ½æœ‰ä»‹ç»ï¼Œæˆ‘åœ¨åˆšæ¥è§¦çš„ pop çš„æ—¶å€™æœ‰å¾ˆå¤šç–‘é—®ï¼Œä¸»è¦æ˜¯åœ¨å®é™…è¿ç”¨çš„æ—¶å€™å‡ºç°çš„ä»£ç å®è·µçš„é—®é¢˜ï¼Œå› ä¸ºä¹‹å‰ä¸€ç›´æ˜¯ç”¨ CA çš„ï¼Œæ€»ä¼šç”¨ CA çš„ç”¨æ³•æ¥å¯»æ‰¾ pop çš„ä½¿ç”¨æŠ€å·§ï¼Œé‚£ä¹ˆå°±æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜è¦ææ¸…æ¥šï¼š

1.  å…·æœ‰å¤šä¸ªåŠ¨ç”»çš„è”åˆåŠ¨ç”»å¦‚ä½•å®ç°ï¼ŒCA ä¸­æœ‰ CAAnimationGroup çš„æ¦‚å¿µï¼Œèƒ½å®ç°åŠ¨ç”»ç»„ï¼Œpop ä¸­è¯¥æ€ä¹ˆåŠï¼Ÿ

2.  æœ‰æ²¡æœ‰é‡å¤æ’­æ”¾åŠ¨ç”»çš„æ¦‚å¿µï¼Œå› ä¸ºæœ‰äº›åŠ¨ç”»æ˜¯å¿…é¡»é‡å¤æ’­æ”¾çš„ã€‚

3.  åœ¨ç°åœ¨å¤§é‡ä½¿ç”¨ autolayout çš„å¸ƒå±€çš„æ—¶å€™ï¼Œå¦‚ä½•ä½¿ç”¨ pop åŠ¨ç”»

ç»“åˆä»¥ä¸Šçš„é—®é¢˜ï¼Œæˆ‘è‡ªå·±åšäº†ä¸€ä¸ªå¡ç‰‡åˆ‡æ¢åŠ¨ç”»çš„ Demo æ¥è¯´æ˜ä¸€ä¸‹ã€‚

![å¡ç‰‡åˆ‡æ¢çš„äº¤äº’åŠ¨ç”»](https://upload-images.jianshu.io/upload_images/24274-0ffe961c658dbbe0.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240/q/100)

å¡ç‰‡è®¾è®¡æ¯”è¾ƒç²—ç³™ï¼Œæ²¡æœ‰è®¾ç½®å¡ç‰‡ä¸Šæ˜ç¡®çš„ç»†å°çš„åˆ†æ å’Œæ–‡å­—åˆ‡æ¢ï¼Œåªæ˜¯ç®€å•çš„æ¨¡ä»¿äº†å¡ç‰‡åˆ‡æ¢å’Œå¡ç‰‡ä¸Šåœ†ç¯çš„åˆ‡æ¢ã€‚

åŠ¨ç”»ç»„çš„æ¦‚å¿µï¼Œè¿™ä¸ªé—®é¢˜åœ¨åšçš„æ—¶å€™ä¸çº ç»“äº†ï¼Œå› ä¸º pop æä¾› pop_addAnimation è¿™æ ·çš„ APIï¼Œå®é™…ä¸Šè¦æƒ³å®ç°åŠ¨ç”»ç»„æ¦‚å¿µï¼Œåœ¨å®è·µä¸­å°±å°†ç”Ÿäº§ Animation çš„ä»£ç å•ç‹¬å°è£…æˆå‡½æ•°ï¼Œç„¶åå¤šæ¬¡è°ƒç”¨ pop_addAnimation å°±å¥½äº†ã€‚æ¯”æ–¹è¯´ï¼Œå¯ä»¥è¿™ä¹ˆåš

```
-(void)setCenter:(CGPoint)center Duration:(CGFloat)duration Card:(cardView *)card Index:(NSUInteger)index{
    POPBasicAnimation * bAni = [POPBasicAnimation animationWithPropertyNamed:kPOPViewCenter];

    bAni.toValue = [NSValue valueWithCGPoint:center];

    bAni.duration = duration;

    [bAni setCompletionBlock:^(POPAnimation *ani, BOOL is) {
        if (is) {
            card.hidden = NO;
        }
    }];
    [card pop_addAnimation:bAni forKey:@"center"];
}

-(void)setScaleWithScalePercent:(CGFloat) percent Duration:(CGFloat)duration Card:(cardView *)card{
    POPBasicAnimation * bAni = [POPBasicAnimation animationWithPropertyNamed:kPOPLayerScaleXY];

    bAni.toValue = [NSValue valueWithCGSize:CGSizeMake(percent, percent)];

    bAni.duration = duration;

    [card.layer pop_addAnimation:bAni forKey:@"123"];
}

-(void)setRorationWithAngle:(CGFloat)angele Duration:(CGFloat)duration Card:(cardView *)card{

    POPBasicAnimation * bAni = [POPBasicAnimation animationWithPropertyNamed:kPOPLayerRotation];
    bAni.duration = duration;
    bAni.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];
    bAni.toValue = [NSNumber numberWithFloat:angele];
    [card.layer pop_addAnimation:bAni forKey:@"213"];
}
```

å°†ä¸Šè¿°å¯¹ cardView å¢åŠ åŠ¨ç”»çš„æ–¹æ³•å†™å¥½ï¼Œç„¶åå¤šæ¬¡è°ƒç”¨

```
[self setScaleWithScalePercent:scalePercent Duration:0.0001f Card:card];

[self setRorationWithAngle:rotation Duration:0.001f Card:card];
```

å¯¹äºé‡å¤çš„åŠ¨ç”»ä½¿ç”¨ï¼Œå¯ä»¥åˆ©ç”¨å¦‚ä¸‹ï¼š

```
-(void)performAnimation
{
    [self setAnimationWithBounciness:self.bouncinessSlider.value andSpeed:self.speedSlider.value];
}
```

å®šä¹‰å¥½æ‰§è¡Œæ–¹æ³•ï¼Œåœ¨ completionBlock ä¸­é‡å¤è°ƒç”¨æ‰§è¡ŒåŠ¨ç”»çš„æ–¹æ³•å°± Okï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å¯¹ pop åŠ¨ç”»å¯¹è±¡å†å°è£…ï¼Œå®ç°é‡å¤æ¬¡æ•°ã€‚

```
anim.completionBlock = ^(POPAnimation *anim, BOOL finished)
{
    if (finished) {
        [self performAnimation];
    }
};
```

å¯¹äº autolayout çš„åŠ¨ç”»

æœ‰äººå†™è¿‡è¿™æ ·çš„ä¾‹å­ï¼Œä»¥ä¸‹æ˜¯ä»£ç ï¼Œpop æ˜¯æ”¯æŒæ›´æ–° layout çš„çº¦æŸçš„ï¼Œè¿™å¯¹æ›´æ–°å…·ä½“æŸä¸ªçº¦æŸæ˜¯æ¯”è¾ƒæœ‰æ•ˆçš„ï¼Œè€Œå¦‚æœä½ åœ¨åšæŸä¸ªç±»ä¼¼ç¿»è½¬åŠ¨ç”»çš„æ—¶å€™ï¼Œå¿…å®šè¦ç”¨åˆ° layer å±‚åŠ¨ç”»ï¼Œé‚£å•å•é æ›´æ–°çº¦æŸå°±ä¸å¤ªèƒ½æ»¡è¶³è¦æ±‚ï¼Œä½†æ˜¯æ°å¥½ä½ åœ¨ä½¿ç”¨ Pop çš„ layer å±‚åŠ¨ç”»çš„æ—¶å€™ï¼Œè¯¥ layer å±äºçš„ View ä¸Šæœ‰ç”¨çº¦æŸå»ºç«‹çš„æ§ä»¶ï¼Œå°±æ¯”è¾ƒéš¾ä»¥å¤„ç†ï¼Œæˆ‘ä¸ªäººçš„æ„è§æ˜¯ï¼Œåš layer å±‚çš„åŠ¨ç”»ï¼Œé‚£ä¸Šé¢çš„å…¶ä»–æ§ä»¶å¹²è„†ä¹Ÿç”¨ frame å¸ƒå±€ã€‚

```
POPAnimatableProperty *constantProperty = [POPAnimatableProperty propertyWithName:@"constant" initializer:^(POPMutableAnimatableProperty *prop){
    prop.readBlock = ^(NSLayoutConstraint *layoutConstraint, CGFloat values[]) {
        values[0] = [layoutConstraint constant];
    };
    prop.writeBlock = ^(NSLayoutConstraint *layoutConstraint, const CGFloat values[]) {
        [layoutConstraint setConstant:values[0]];
    };
}];
POPSpringAnimation *constantAnimation = [POPSpringAnimation animation];
constantAnimation.property = constantProperty;
constantAnimation.fromValue = @(_layoutConstraint.constant);
constantAnimation.toValue = @(200);
[_layoutConstraint pop_addAnimation:constantAnimation forKey:@"constantAnimation"];
```

ä»¥ä¸Šå°±æ˜¯ä¸€åˆ‡ä½¿ç”¨é—®é¢˜çš„æ€»ç»“ï¼Œè¯¦ç»†çš„ä½¿ç”¨å¯ä»¥å‚è€ƒæºç ã€‚
[DEMO åœ°å€](https://github.com/Neojoke/cardsAnimation)
å–œæ¬¢çš„ç‚¹ä¸ªèµ ğŸ‘
